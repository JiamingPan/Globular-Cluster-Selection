# -*- coding: utf-8 -*-
"""M31 outer halo GC candidates.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/14Ktbd7nX6IsFn6QIu2OoGVgi9NuStDA_
"""

# Commented out IPython magic to ensure Python compatibility.
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
# %matplotlib inline

from scipy.interpolate import UnivariateSpline
from matplotlib.patches import *
from matplotlib.path import *
from scipy.io import readsav

from astropy.io import ascii,fits
from astropy.coordinates import Angle
import astropy.units as u
from astropy.wcs import WCS
from astropy.coordinates import SkyCoord
from astropy.coordinates import match_coordinates_sky
from scipy.interpolate import interp1d

from google.colab import drive
drive.mount('/gdrive')

!git clone https://github.com/sciserver/Notebooks.git

# Commented out IPython magic to ensure Python compatibility.
# %cd Notebooks/required-files/
import img_scale

class SFD:
    def __init__(self, path="./"):
        
        
        f_sfd_n = fits.open('/gdrive/My Drive/Astro Research/' + "SFD_dust_4096_ngp.fits")
        self.sfd_north =  f_sfd_n[0].data
        
        f_sfd_s = fits.open('/gdrive/My Drive/Astro Research/' + "SFD_dust_4096_sgp.fits")
        self.sfd_south =  f_sfd_s[0].data
        
        self.wcs_north = WCS(f_sfd_n[0].header)
        self.wcs_south = WCS(f_sfd_s[0].header)

!git clone https://github.com/sciserver/Notebooks.git

# Commented out IPython magic to ensure Python compatibility.
# %cd Notebooks/required-files/
import img_scale

dm64 = 4500.0   # Distance to M64
dm83 = 4800.0   # Distance to M83
dm81 = 3500.0   # Distance to M81
dm94 = 4500.0   # Distance to M94

# dmod should be the distance to your favorite galaxy; either dm81, dm83, dm94, dm64
dmod = 5.*np.log10(dm64*1000.)-5.
dmodm81 = 5.*np.log10(dm81*1000.)-5.
pxs = 0.16667

m64_ra, m64_dec = Angle('12 56 43.6 hours').deg, \
        Angle('+21 40 59 degrees').deg
m81_ra, m81_dec = Angle('09 55 33.17306 hours').deg, \
                  Angle('+69 03 55.0610 degrees').deg
m82_ra, m82_dec = Angle('09 55 52.430 hours').deg, \
                  Angle('+69 40 46.93 degrees').deg
ngc3077_ra, ngc3077_dec = Angle('10 03 19.0965510921 hours').deg, \
                          Angle('+68 44 01.556166166 degrees').deg
m83_ra, m83_dec = Angle('13 37 00.9 hours').deg, \
        Angle('-29 51 56 degrees').deg
m94_ra, m94_dec = Angle('12 50 53.0 hours').deg, \
        Angle('+41 07 14 degrees').deg

googlepath = '/gdrive/My Drive/Astro Research/'
datafile = 'm81-20190729.fits' # Adjust this - it needs to be m81, m83, m64 or m94
f = fits.open(googlepath+datafile)
d = f[1].data
f.close()

stlrlc = readsav(googlepath+'gri_stellarlocus.sav')
locus_spline = UnivariateSpline(stlrlc['rimn'], stlrlc['grmn'], s=0.085)

scoords = SkyCoord(ra=d['ra']*180./np.pi, dec=d['dec']*180./np.pi,
                         unit=(u.deg, u.deg), frame='icrs')

# SFD correction of magnitudes
sfd  = SFD(path=googlepath+"SFD/")
sgal_coords = scoords.galactic
x,y = sfd.wcs_south.wcs_world2pix(sgal_coords.l.deg, sgal_coords.b.deg, 0) #south
ok_coords, = np.where(x > 0)
EBV = np.zeros(len(scoords))
EBV[ok_coords] = sfd.sfd_north[x[ok_coords].astype(int),
                               y[ok_coords].astype(int)]
A_g = 3.303*EBV
A_r = 2.285*EBV
A_i = 1.698*EBV

g0 = np.hstack([d['gMag']])-A_g
r0 = np.hstack([d['rMag']])-A_r
i0 = np.hstack([d['iMag']])-A_i

# Errors are really bad, so make rescaled errors - 
# first step is to find the lower (in flux) quartile, that is used as 5 sigma for the rescaling of errors.
gmed = np.nanmedian(g0)
whlo, = np.where(g0>gmed)
glo = np.nanmedian(g0[whlo])
rmed = np.nanmedian(r0)
whlo, = np.where(r0>rmed)
rlo = np.nanmedian(r0[whlo])
imed = np.nanmedian(i0)
whlo, = np.where(i0>imed)
ilo = np.nanmedian(i0[whlo])

# Make rescaled errors
dg0 = -2.5*np.log10(10.0**(-0.4*g0) - 0.2*10.0**(-0.4*glo))-g0
toolow,=np.where(dg0<0.02)
dg0[toolow]=np.zeros(len(toolow))+0.02
dr0 = -2.5*np.log10(10.0**(-0.4*r0) - 0.2*10.0**(-0.4*rlo))-r0
toolow,=np.where(dr0<0.02)
dr0[toolow]=np.zeros(len(toolow))+0.02
di0 = -2.5*np.log10(10.0**(-0.4*i0) - 0.2*10.0**(-0.4*ilo))-i0
toolow,=np.where(di0<0.02)
di0[toolow]=np.zeros(len(toolow))+0.02

gi0 = g0 - i0
dgi0 = np.sqrt(dg0**2 + di0**2)
ri0 = r0 - i0
dri0 = np.sqrt(dr0**2 + di0**2)
gr0 = g0 - r0
dgr0 = np.sqrt(dg0**2 + dr0**2)

shpxx = np.hstack(d['shape_xx'])*pxs
shpyy = np.hstack(d['shape_yy'])*pxs
shp = 0.5*np.hstack([d['shape_xx']+d['shape_yy']])*pxs # average of xx, yy.

ra = np.hstack([d['ra']])*180./np.pi
dec = np.hstack([d['dec']])*180./np.pi

gd, = np.where( (gi0 > -1) & (gi0 < 3.5) &
                (ri0 > -1) & (ri0 < 2.5) )
cmd,cmdy,cmdx = np.histogram2d(i0[gd],gi0[gd],bins=(250,125),normed=False)
cmds = img_scale.log(cmd,scale_min=1,scale_max=1.e6)

cc,ccy,ccx = np.histogram2d(ri0[gd],gr0[gd],bins=(250,250),normed=False)
ccs = img_scale.log(cc,scale_min=1,scale_max=1.e6)

"""SDSS does not capture many known GCs. This makes IRAC, SDSS, GAIA, and WISE, SDSS, GAIA have the same five known GCs.

#M31 


*   GAIA
*   SDSS
*   WISE (matched with SDSS and GAIA)
*   DES



10.68470833,41.26875
"""

m31_ra, m31_dec = Angle('00 42 44.3 hours').deg, \
                  Angle('+41 16 9 degrees').deg

dm31 = 777
def ra2kpc(deg):
    ddeg = (deg-m31_ra)*np.cos(np.pi/180.*m31_dec)            
    return ddeg*np.pi/180. * dm31

# ra -5, 25
#dec 26.26. 56.3

from mpl_toolkits.axes_grid1 import make_axes_locatable
from scipy.optimize import curve_fit
from astropy.modeling import models, fitting
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/m31 gaiadr2.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra'][:]
ggdec=gaia3['dec'][:]

#Cut for candidates #2 1.2 #1 1
#gacl=((ggga-rpgga > 0.4*(bpgga-ggga)+1.3)&
#      (ggga-rpgga > -1.3*(bpgga-ggga)+0.6)&(ggga-rpgga < -1.2*(bpgga-ggga)+1.4)&(ggga<20.5)&(ggga-rpgga < -1.05*(bpgga-ggga)+1.4)&(ggga<21))

gaspecc, gaspeccdist, _ = match_coordinates_sky(gaiaccd,speccald) 
# find nearest match 0.8
gaclpec = gaspeccdist.arcsec<0.8


brigga = ((ggga[gaclpec]<21))
smalex = ((bregga[gaclpec]<2))

#possible contaminant 
conta = np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))

a=bpgga-ggga
b=0.3+1.1*a-0.29*a*a
#CC of gaia
#GC candidates in GAIA
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
#field 14

#pgcga = Path([(-0.93,2.3),(-0.93,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.93,2.3)])
pgcga = Path([(-0.87,2.3),(-0.87,2.3),
          (0,1.4),(-0.2,1.3),
          (-0.6,1.5),(-1.15,2.1),(-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = np.where(ingcga==True)

gccan = np.where((aengga[gcga]>5)&(bregga[gcga]>2)&(ggga[gcga]<19)&(rpgga[gcga]<17))
contamin = np.where((pa31[gcga]>0)|(pa31[gcga]<0)|(ra31[gcga]>0)|(ra31[gcga]<0))
#ggrac = np.delete(ggra[gcga][gccan],contamin,axis=0)
#ggdecc = np.delete(ggdec[gcga][gccan],contamin,axis=0)
#bpggac = np.delete(bpgga[gcga][gccan],contamin,axis=0)
#gggac = np.delete(ggga[gcga][gccan],contamin,axis=0)
#rpggac = np.delete(rpgga[gcga][gccan],contamin,axis=0)
plt.figure(figsize=(18,19),frameon=False)
ax2=plt.subplot(221)
ax2.set_ylim(-0.5,3)
ax2.set_xlim(-1.5,2)
plt.plot(bpgga-ggga, ggga-rpgga, 'k.', alpha=0.01,markersize=1)
plt.plot(bpgga-ggga, b, 'k.', markersize=0.1,label='color edge')
plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
plt.plot(bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
print('bp',bpgga[gaclpec][conta])
print('rp',rpgga[gaclpec][conta])
ax2=plt.subplot(222)
ax2.set_xlim(-1,3.5)
ax2.set_ylim(22,10)
plt.plot(bpgga-rpgga, ggga, 'k.', alpha=0.01,markersize=1)
#plt.plot(bpgga[gacl]-rpgga[gacl], ggga[gacl], 'g.', alpha=0.6,markersize=3,label='GC candidates')
plt.plot(bpgga[gaclpec]-rpgga[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.plot(bpggac-rpggac, gggac, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.set_xlabel('$bp-rp$',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
ax2.plot(ggra,ggdec, 'k.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#plt.plot(ggra[gacl], ggdec[gacl], 'g.', alpha=1,markersize=4,label='GC candidates')
ax2.plot(ggra[gaclpec], ggdec[gaclpec], 'bx', alpha=1,markersize=4,label='confirmed GCs')
ax2.plot(ggra[gaclpec][conta], ggdec[gaclpec][conta], 'rx', alpha=1,markersize=5,label='contaminant')
#ax2.plot(ggrac, ggdecc, 'gx', alpha=1,markersize=5,label='GC candidates')
#ax2.plot(ggra[gaclpec][innergc],ggdec[gaclpec][innergc], 'bx', alpha=1,markersize=4)
#ax2.plot(ggra[gaclpec][outergc],ggdec[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlim(min(ggra),max(ggra)) 
ax2.set_ylim(min(ggdec),max(ggdec))
#ax2.set_xlim(15.68470833,5.68470833) 
#ax2.set_ylim(36.26875,46.26875)
ax2.legend(loc='lower left', frameon=False)
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(ggra)),ra2kpc(min(ggra)))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)

ax2=plt.subplot(224)
plt.plot(gaspeccdist.arcsec, ggga, 'k.', alpha=0.3,markersize=3)
plt.plot(gaspeccdist.arcsec[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=3 ,label='confirmed GCs')
plt.plot(gaspeccdist.arcsec[gaclpec][conta], ggga[gaclpec][conta], 'rx', alpha=1,markersize=5 ,label='contaminant')
ax2.set_xlabel('separation from the nearest GC source',fontsize=15)
ax2.set_ylabel('$(G)(GAIA)$',fontsize=15)
ax2.set_xlim(0,2)
ax2.set_ylim(22,13)
ax2.legend(loc='lower right', frameon=False)

#Check BR excess and AEN
plt.figure(figsize=(19,18*2),frameon=False)
ax2=plt.subplot(421)
ax2.set_ylim(1,6)
ax2.set_xlim(12.5,21)
plt.plot(rpgga, bregga, 'k.', alpha=0.06,markersize=1)
plt.plot(rpgga[gaclpec], bregga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$rp$',fontsize=15)
ax2.set_ylabel('phot_bp_rp_excess_factor',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(422)
ax2.set_ylim(-0.5,3)
ax2.set_xlim(-1.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
#plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],c
#            ,alpha=1)
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=bregga[gaclpec],marker='x',cmap='inferno_r',vmax=5,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('phot_bp_rp_excess_factor',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)

ax2=plt.subplot(423)
ax2.set_ylim(0,22)
ax2.set_xlim(13,21)
plt.plot(ggga, aengga, 'k.', alpha=0.06,markersize=1)
plt.plot(ggga[gaclpec], aengga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('astrometric_excess_noise',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(424)
ax2.set_ylim(-0.5,3)
ax2.set_xlim(-1.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=aengga[gaclpec],marker='x',cmap='inferno_r',vmax=20,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('astrometric_excess_noise',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$', fontsize=15)
plt.tight_layout

ax2=plt.subplot(425)
ax2.set_ylim(-300,300)
ax2.set_xlim(5,15.5)
plt.plot(ggga, ra31, 'k.', alpha=1,markersize=4)
plt.plot(ggga[gaclpec], ra31[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('radial_velocity (km/s)',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(426)
ax2.set_ylim(-10,10)
ax2.set_xlim(5,22)
plt.plot(ggga, pa31, 'k.', alpha=0.03,markersize=1)
plt.plot(ggga[gaclpec], pa31[gaclpec], 'rx', alpha=1,markersize=6 ,label='contaminant')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('parallax mas',fontsize=15) #1 mas = 1/1000 arcsecond
ax2.legend(loc='upper left', frameon=False)

print(len(ggga[gaclpec])) #detected 205, and have 441 GCs in this data: captured 46%
print(len(ra31))
print('radial velocity for m31 gcs',len(ra31[gaclpec][np.where((ra31[gaclpec]>0)|(ra31[gaclpec]<0))])) #no radial velocity for GCs

print(len(pa31))
print('parallax for m31 GCs',len(pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))]))
print('values of parallax for m31 GCs',pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))])
print('nubmer of identified GCs',len(ggga[gaclpec]))

"""#SDSS"""

#SDSS
#p.ra,p.dec,p.u,p.g,p.r,p.i
#Match with Subaru
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31SDSSdr16radiucentera_jiamingp.fit')
sdss = fs[1].data
sdsscd3 = SkyCoord(ra=sdss['ra'][:],
                      dec=sdss['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3 = sdsscd3.ravel()
#Less obejcts at fainter mag in this case.
x=(np.log(10)/(-2.5))*sdss['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss['i'] = sdss['i'].ravel()
isd = sdss['i']

x=(np.log(10)/(-2.5))*sdss['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss['g'] = sdss['g'].ravel()
gsd = sdss['g']

x=(np.log(10)/(-2.5))*sdss['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss['r'] = sdss['r'].ravel()
rsd = sdss['r']

x=(np.log(10)/(-2.5))*sdss['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss['u'] = sdss['u'].ravel()
usd = sdss['u']

x=(np.log(10)/(-2.5))*sdss['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss['z'] = sdss['z'].ravel()
zsd = sdss['z']
sdra = sdss['ra']
sddec = sdss['dec']
radu = sdss['petroRad_u']
radg = sdss['petroRad_g']
radr = sdss['petroRad_r']
radi = sdss['petroRad_i']
radz = sdss['petroRad_z']


#PSF magnitude error (I presume)
#erg = sdss['Err_g']
#err = sdss['Err_r']
#eri = sdss['Err_i']
#load in known GCs. Nelson Caldwell 2016.fit
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  
#Select known GCs
sdgc, sdgcdist, _ = match_coordinates_sky(sdsscd3,speccald)
sdssgcs = sdgcdist.arcsec<0.6

#candidates
xyp = np.empty([len(rsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd
#field 14

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.4)])
ingcsd = pgcsd.contains_points(xyp) 
gcsd = np.where(ingcsd==True)


plt.figure(figsize=(19,24),frameon=False)
#CC diagram from SDSS Plot CC of candidates from Subaru and IRAC (or GALEX, SDSS)
ax2=plt.subplot(321)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd-rsd, rsd-isd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#ax2.plot(gnew[uvmtchi[clsuv&starsmall[uvmtchi]]]-inew[uvmtchi[clsuv&starsmall[uvmtchi]]], uvmag[clsuv&starsmall[uvmtchi]], 'r.', alpha=0.4,markersize=2,lw=0, markeredgecolor='none')
#CC of candidates from Subaru red
#ax2.plot(gsd[gcsd&posscand[sdsuba]]-rsd[gcsd&posscand[sdsuba]],rsd[gcsd&posscand[sdsuba]]-isd[gcsd&posscand[sdsuba]], 'r.', alpha=0.4,markersize=4,label='Candidates at Subaru')
#ax2.plot(gsd[gcsd&startf[sdsuba]]-rsd[gcsd&startf[sdsuba]],rsd[gcsd&startf[sdsuba]]-isd[gcsd&startf[sdsuba]], 'y.', alpha=0.45,markersize=3,label='stars')
#CC of candidates from IRAC
#ax2.plot(gsd[gcsd&bigblu[sdsuba]]-rsd[gcsd&bigblu[sdsuba]],rsd[gcsd&bigblu[sdsuba]]-isd[gcsd&bigblu[sdsuba]], 'g.', alpha=1,markersize=4,lw=0, markeredgecolor='none',label='IRAC Candidates')
#ax2.plot(gsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]]-rsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]],rsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]]-isd[gcsd&posscand[sdsuba]&bigblu[sdsuba]], 'g.', alpha=0.8,markersize=5,label='Candidates of Boath Irac and Subaru')
#ax2.plot(gnew[uvmtchi[clsuv&bigblu[sdsuba]]]-inew[uvmtchi[clsuv&bigblu[uvmtchi]]], uvmag[clsuv&bigblu[uvmtchi]], 'g.', alpha=1,markersize=4,lw=0, markeredgecolor='none',label='GALEX Candidates')
#ax2.plot(gsd[gcsd&startf[sdsuba]]-rsd[gcsd&startf[sdsuba]],rsd[gcsd&startf[sdsuba]]-isd[gcsd&startf[sdsuba]], 'y.', alpha=0.45,markersize=3,label='stars')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(r-i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(322)
ax2.plot(usd-rsd, rsd-isd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(usd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(u-r)(SDSS)$')
ax2.set_ylabel('$(r-i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(323)
ax2.plot(gsd-rsd, rsd-zsd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(r-z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(ccy[0],ccy[-1]+1)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(324)
ax2.plot(usd-rsd, rsd-zsd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(usd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(u-r)(SDSS)$')
ax2.set_ylabel('$(r-z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcsd,facecolor='none',edgecolor='red',lw=1.5))

m31_ra, m31_dec = Angle('00 42 44.3 hours').deg, \
                  Angle('+41 16 9 degrees').deg
dm31 = 777
def ra2kpc(deg):
    ddeg = (deg-m31_ra)*np.cos(np.pi/180.*m31_dec)            
    return ddeg*np.pi/180. * dm31

ax2=plt.subplot(325)
ax2.plot(sdra, sddec, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(sdra[sdssgcs],sddec[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('ra')
ax2.set_ylabel('dec')
ax2.set_xlim(5.68470833,15.68470833) 
ax2.set_ylim(46.26875,36.26875)
ax2.legend(loc='lower left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sdra)),ra2kpc(min(sdra)))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)

print('known GCs captured',len(zsd[sdssgcs])) #captured 126 out of 441: 28.6%

plt.figure(figsize=(10,10),frameon=False)
#CC diagram from SDSS Plot CC of candidates from Subaru and IRAC (or GALEX, SDSS)
ax2=plt.subplot(221)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radg, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[sdssgcs],radg[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
#ax2.plot(gsd[gcsd][sdgccan], radg[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('g   Petrosian radius $(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(222)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radu, 'k.', alpha=0.02,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[sdssgcs],radu[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
#ax2.plot(gsd[gcsd][sdgccan], radu[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('u   Petrosian radius $(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radz, 'k.', alpha=0.02,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[sdssgcs],radz[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
#ax2.plot(gsd[gcsd][sdgccan], radz[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('z   Petrosian radius $(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

"""#Gaia and Wise"""

import pandas as pd 
wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/M31_wise.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/m31 gaiadr2.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra']
ggdec=gaia3['dec']


#print(myFile['ra'])

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,gaiaccd)
cls = wisemtchdist.arcsec<0.75
#    irgc, irgcdist, _ = match_coordinates_sky(iraccd,knowngc)
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,gaiaccd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8

print('#GCs in wise',len(wise2[clpec]))

#Cut for GC candidates
#y =  gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise2[cls&gcgalaxy[wisemtchi]]
#x=bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]
#gcwiga = ((y<x*34-30.9)&(y>x*18.8-23.2)&(y>1.9))

# This is awesome! Now do some diagnostic plots, figure out who matched.
    # distance  
plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
#figure(1).clear()
ax2=plt.subplot(231)
#GAIA Data black
#x2.plot(bpgga-rpgga, ggga, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')

ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]], 'k.', alpha=0.1,markersize=1, label='match with WISE')
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G$')
ax2.set_xlim(-1,3.5)
ax2.set_ylim(21,9)
ax2.legend(loc='upper left', frameon=False)


ax2=plt.subplot(232)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.01,markersize=1)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise1[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.8,markersize=2,label='GC candidates (gaia)')
#ax2.plot(bpga[gairmtchi[cls&bigblu[irmtchi]]]-rpga[gairmtchi[cls&bigblu[irmtchi]]], gga[gairmtchi[cls&bigblu[irmtchi]]]-iracmag[cls&bigblu[irmtchi]],'b.', alpha=0.7,markersize=2,label='IRAC candidates')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[3.4]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(233)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.08,markersize=2)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise2[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.6,markersize=2,label='GC candidates (gaia)')
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga]-wise2[cls&gcgalaxy[wisemtchi]][gcwiga],'r.', alpha=0.8,markersize=2,label='GC candidates')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[4.6]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.08,markersize=2)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise4[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.8,markersize=2,label='GC candidates (gaia)')
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[22]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise3[cls], 'k.', alpha=0.08,markersize=2)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise3[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.8,markersize=2,label='GC candidates (gaia)')
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise3[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[12]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,12)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(236)
ax2.plot(ggra[wisemtchi[cls]], ggdec[wisemtchi[cls]], 'k.', alpha=0.1,markersize=2)
#ax2.plot(gra[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gdec[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#Confirmed GCs
ax2.plot(ggra[wisemtchi[clpec]], ggdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
ax2.set_xlim(9.18470833,12.18470833) 
ax2.set_ylim(42.26875,40.26875)
ax2.legend(loc='upper left', frameon=False)
#plt.tight_layout()

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(ggra[wisemtchi[cls]])),ra2kpc(min(ggra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(len(ggra[wispec[clpec]]))

plt.tight_layout()

"""#SDSS and WISE"""

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/M31_wise.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31eeeSDSSdr16_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss['i'] = sdss['i'].ravel()
isd = sdss['i']

x=(np.log(10)/(-2.5))*sdss['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss['g'] = sdss['g'].ravel()
gsd = sdss['g']

x=(np.log(10)/(-2.5))*sdss['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss['r'] = sdss['r'].ravel()
rsd = sdss['r']

x=(np.log(10)/(-2.5))*sdss['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss['u'] = sdss['r'].ravel()
usd = sdss['u']

x=(np.log(10)/(-2.5))*sdss['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss['z'] = sdss['z'].ravel()
zsd = sdss['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()

wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,sdsscd3)
cls = wisemtchdist.arcsec<0.75
#Mackey_2018_ Pandas.fit. Nelson Caldwell 2016.fit
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
mackey = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([mackey['RAJ2000']]),
                    dec=np.hstack([mackey['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8

xyp = np.empty([len(wise2[cls]),2]) 
xyp[:,1] = rsd[wisemtchi[cls]]-wise2[cls]
xyp[:,0] = gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]]

pgcwi = Path([(0.5,2),(0.76,2.84),
          (0.86,2.44),(0.6,1.81),(0.5,2)])
ingcwi = pgcwi.contains_points(xyp) 
gcwi = np.where(ingcwi==True)

print('#GCs in wise and SDSS',len(wise2[clpec]))

plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.5,markersize=1, label='match with WISE')
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-[4.6])$')
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))


ax2=plt.subplot(233)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.5,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[22])$')
ax2.set_xlim(0,7)
ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.5,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[3.4])$')
ax2.set_xlim(-3.5,4)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.5,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[4.6])$')
ax2.set_xlim(-3.5,4)
ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.5,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[3.4])$')
ax2.set_xlim(-3.5,5)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(236)
ax2.plot(sra[wisemtchi[cls]], sdec[wisemtchi[cls]], 'k.', alpha=0.1,markersize=2)
#ax2.plot(gra[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gdec[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#Confirmed GCs
ax2.plot(sra[wisemtchi[clpec]], sdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
ax2.set_xlim(9.18470833,12.18470833) 
ax2.set_ylim(42.26875,40.26875)
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(len(ggra[wispec[clpec]]))

plt.tight_layout()

"""#most distant M31 GCs (10.6, 41.26)


*   Gaia DR 3
*   WISE 
*  SDSS


"""

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31Gaiadr3_10deg.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra'][:]
ggdec=gaia3['dec'][:]

#Cut for candidates #2 1.2 #1 1
#gacl=((ggga-rpgga > 0.4*(bpgga-ggga)+1.3)&
#      (ggga-rpgga > -1.3*(bpgga-ggga)+0.6)&(ggga-rpgga < -1.2*(bpgga-ggga)+1.4)&(ggga<20.5)&(ggga-rpgga < -1.05*(bpgga-ggga)+1.4)&(ggga<21))

gaspecc, gaspeccdist, _ = match_coordinates_sky(gaiaccd,speccald) 
# find nearest match 0.8
gaclpec = gaspeccdist.arcsec<0.8


brigga = ((ggga[gaclpec]<21))
smalex = ((bregga[gaclpec]<2))

#possible contaminant 
conta = np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))

a=bpgga-ggga
b=0.3+1.1*a-0.29*a*a
#CC of gaia
#GC candidates in GAIA
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
#field 14

#pgcga = Path([(-0.93,2.3),(-0.93,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.93,2.3)])
pgcga = Path([(-0.87,2.3),(-0.87,2.3),
          (0,1.4),(-0.2,1.3),
          (-0.6,1.5),(-1.15,2.1),(-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = np.where(ingcga==True)

gccan = np.where((aengga[gcga]>5)&(bregga[gcga]>2)&(ggga[gcga]<19)&(rpgga[gcga]<17))
contamin = np.where((pa31[gcga]>0)|(pa31[gcga]<0)|(ra31[gcga]>0)|(ra31[gcga]<0))
#ggrac = np.delete(ggra[gcga][gccan],contamin,axis=0)
#ggdecc = np.delete(ggdec[gcga][gccan],contamin,axis=0)
#bpggac = np.delete(bpgga[gcga][gccan],contamin,axis=0)
#gggac = np.delete(ggga[gcga][gccan],contamin,axis=0)
#rpggac = np.delete(rpgga[gcga][gccan],contamin,axis=0)
plt.figure(figsize=(18,19),frameon=False)
ax2=plt.subplot(221)
ax2.set_ylim(-0.5,6)
ax2.set_xlim(-4.5,2)
plt.plot(bpgga-ggga, ggga-rpgga, 'k.', alpha=0.01,markersize=1)
plt.plot(bpgga-ggga, b, 'k.', markersize=0.1,label='color edge')
plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
plt.plot(bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
#print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
#print('bp',bpgga[gaclpec][conta])
#print('rp',rpgga[gaclpec][conta])
ax2=plt.subplot(222)
ax2.set_xlim(-2.5,3.5)
ax2.set_ylim(22,10)
plt.plot(bpgga-rpgga, ggga, 'k.', alpha=0.01,markersize=1)
#plt.plot(bpgga[gacl]-rpgga[gacl], ggga[gacl], 'g.', alpha=0.6,markersize=3,label='GC candidates')
plt.plot(bpgga[gaclpec]-rpgga[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.plot(bpggac-rpggac, gggac, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.set_xlabel('$bp-rp$',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
ax2.plot(ggra,ggdec, 'k.', alpha=0.04,markersize=1,lw=0, markeredgecolor='none')
#plt.plot(ggra[gacl], ggdec[gacl], 'g.', alpha=1,markersize=4,label='GC candidates')
ax2.plot(ggra[gaclpec], ggdec[gaclpec], 'bx', alpha=1,markersize=4,label='confirmed GCs')
ax2.plot(ggra[gaclpec][conta], ggdec[gaclpec][conta], 'rx', alpha=1,markersize=5,label='contaminant')
#ax2.plot(ggrac, ggdecc, 'gx', alpha=1,markersize=5,label='GC candidates')
#ax2.plot(ggra[gaclpec][innergc],ggdec[gaclpec][innergc], 'bx', alpha=1,markersize=4)
#ax2.plot(ggra[gaclpec][outergc],ggdec[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlim(min(ggra),max(ggra)) 
ax2.set_ylim(min(ggdec),max(ggdec))
#ax2.set_xlim(21.68470833,-3.68470833) 
#ax2.set_ylim(25.26875,51.26875)
ax2.legend(loc='lower left', frameon=False)
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(min(ggra)),ra2kpc(max(ggra)))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(ggra,ggdec)
ax2=plt.subplot(224)
plt.plot(gaspeccdist.arcsec, ggga, 'k.', alpha=0.3,markersize=3)
plt.plot(gaspeccdist.arcsec[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=3 ,label='confirmed GCs')
plt.plot(gaspeccdist.arcsec[gaclpec][conta], ggga[gaclpec][conta], 'rx', alpha=1,markersize=5 ,label='contaminant')
ax2.set_xlabel('separation from the nearest GC source',fontsize=15)
ax2.set_ylabel('$(G)(GAIA)$',fontsize=15)
ax2.set_xlim(0,2)
ax2.set_ylim(22,13)
ax2.legend(loc='lower right', frameon=False)

#Check BR excess and AEN
plt.figure(figsize=(19,18*2),frameon=False)
ax2=plt.subplot(421)
ax2.set_ylim(1,6)
ax2.set_xlim(12.5,21)
plt.plot(rpgga, bregga, 'k.', alpha=0.06,markersize=1)
plt.plot(rpgga[gaclpec], bregga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$rp$',fontsize=15)
ax2.set_ylabel('phot_bp_rp_excess_factor',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(422)
ax2.set_ylim(-0.5,3)
ax2.set_xlim(-1.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
#plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],c
#            ,alpha=1)
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=bregga[gaclpec],marker='x',cmap='inferno_r',vmax=5,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('phot_bp_rp_excess_factor',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)

ax2=plt.subplot(423)
ax2.set_ylim(0,22)
ax2.set_xlim(13,21)
plt.plot(ggga, aengga, 'k.', alpha=0.06,markersize=1)
plt.plot(ggga[gaclpec], aengga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('astrometric_excess_noise',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(424)
ax2.set_ylim(-0.5,3)
ax2.set_xlim(-1.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=aengga[gaclpec],marker='x',cmap='inferno_r',vmax=20,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('astrometric_excess_noise',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$', fontsize=15)
plt.tight_layout

ax2=plt.subplot(425)
ax2.set_ylim(-300,300)
ax2.set_xlim(5,15.5)
plt.plot(ggga, ra31, 'k.', alpha=1,markersize=4)
plt.plot(ggga[gaclpec], ra31[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('radial_velocity (km/s)',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(426)
ax2.set_ylim(-10,10)
ax2.set_xlim(5,22)
plt.plot(ggga, pa31, 'k.', alpha=0.03,markersize=1)
plt.plot(ggga[gaclpec], pa31[gaclpec], 'rx', alpha=1,markersize=6 ,label='contaminant')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('parallax mas',fontsize=15) #1 mas = 1/1000 arcsecond
ax2.legend(loc='upper left', frameon=False)

print(len(ggga[gaclpec])) #detected 205, and have 441 GCs in this data: captured 46%
print(len(ra31))
print('radial velocity for m31 gcs',len(ra31[gaclpec][np.where((ra31[gaclpec]>0)|(ra31[gaclpec]<0))])) #no radial velocity for GCs

print(len(pa31))
print('parallax for m31 GCs',len(pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))]))
print('values of parallax for m31 GCs',pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))])
print('nubmer of identified GCs',len(ggga[gaclpec]))

#3 degree 41 kpc 1 degree 13.666667

"""#Lower Left Circle of M31 (5, 36)

Distance from the ceneter: 7.68 degree = 105 Kpc
"""

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31_lowerleft_GaiaDR3.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra'][:]
ggdec=gaia3['dec'][:]

#Cut for candidates #2 1.2 #1 1
#gacl=((ggga-rpgga > 0.4*(bpgga-ggga)+1.3)&
#      (ggga-rpgga > -1.3*(bpgga-ggga)+0.6)&(ggga-rpgga < -1.2*(bpgga-ggga)+1.4)&(ggga<20.5)&(ggga-rpgga < -1.05*(bpgga-ggga)+1.4)&(ggga<21))

gaspecc, gaspeccdist, _ = match_coordinates_sky(gaiaccd,speccald) 
# find nearest match 0.8
gaclpec = gaspeccdist.arcsec<0.8


brigga = ((ggga[gaclpec]<21))
smalex = ((bregga[gaclpec]<2))

#possible contaminant 
conta = np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))

a=bpgga-ggga
b=0.3+1.1*a-0.29*a*a
#CC of gaia
#GC candidates in GAIA
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
#field 14

#pgcga = Path([(-0.93,2.3),(-0.93,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.93,2.3)])
#pgcga = Path([(-0.87,2.3),(-0.87,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.87,2.3)])
pgcga = Path([(-0.87,2.3),(-2.,2.8),
          (-3.4,4.4),(-3.5,4.9),
          (-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = np.where(ingcga==True)

gccan = np.where((aengga[gcga]>5)&(bregga[gcga]>2)&(ggga[gcga]<19)&(rpgga[gcga]<17))
contamin = np.where((pa31[gcga]>0)|(pa31[gcga]<0)|(ra31[gcga]>0)|(ra31[gcga]<0))
m31can = np.where((aengga[gcga]>5)&(bpgga[gcga]-rpgga[gcga]>1)&(bregga[gcga]>10)&(bregga[gcga]<20)&(ggga[gcga]<20.5)&(ggga[gcga]>16)&(bpgga[gcga]-ggga[gcga]>-2.4))
#ggrac = np.delete(ggra[gcga][gccan],contamin,axis=0)
#ggdecc = np.delete(ggdec[gcga][gccan],contamin,axis=0)
#bpggac = np.delete(bpgga[gcga][gccan],contamin,axis=0)
#gggac = np.delete(ggga[gcga][gccan],contamin,axis=0)
#rpggac = np.delete(rpgga[gcga][gccan],contamin,axis=0)
plt.figure(figsize=(18,19),frameon=False)
ax2=plt.subplot(221)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
plt.plot(bpgga-ggga, ggga-rpgga, 'k.', alpha=0.01,markersize=1)
plt.plot(bpgga-ggga, b, 'k.', markersize=0.1,label='color edge')
plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='contamin')
ax2.plot(bpgga[gcga][m31can]-ggga[gcga][m31can], ggga[gcga][m31can]-rpgga[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates') #[gcga][m31can]
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
print('bp',bpgga[gaclpec][conta])
print('rp',rpgga[gaclpec][conta])
ax2=plt.subplot(222)
ax2.set_xlim(-2.5,3.5)
ax2.set_ylim(22,10)
plt.plot(bpgga-rpgga, ggga, 'k.', alpha=0.01,markersize=1)
#plt.plot(bpgga[gacl]-rpgga[gacl], ggga[gacl], 'g.', alpha=0.6,markersize=3,label='GC candidates')
plt.plot(bpgga[gaclpec]-rpgga[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.plot(bpggac-rpggac, gggac, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.set_xlabel('$bp-rp$',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
ax2.plot(ggra,ggdec, 'k.', alpha=0.04,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(5,36, 'b.', alpha=1,markersize=3,lw=0, markeredgecolor='none',label='center')
#plt.plot(ggra[gacl], ggdec[gacl], 'g.', alpha=1,markersize=4,label='GC candidates')
ax2.plot(ggra[gaclpec], ggdec[gaclpec], 'bx', alpha=1,markersize=4,label='confirmed GCs')
ax2.plot(ggra[gaclpec][conta], ggdec[gaclpec][conta], 'rx', alpha=1,markersize=5,label='contaminant')
#ax2.plot(ggrac, ggdecc, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.plot(ggra[gcga][m31can],ggdec[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates')
#ax2.plot(ggra[gaclpec][innergc],ggdec[gaclpec][innergc], 'bx', alpha=1,markersize=4)
#ax2.plot(ggra[gaclpec][outergc],ggdec[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.set_xlim(max(ggra),min(ggra)) 
ax2.set_xlim(-3,13)
ax2.set_ylim(min(ggdec),max(ggdec))
print('number of Candidates',len(ggra[gcga][m31can]))
#ax2.set_xlim(21.68470833,-3.68470833) 
#ax2.set_ylim(25.26875,51.26875)
ax2.legend(loc='lower left', frameon=False)
racon = np.where((ggra<16)&(ggra>-2))
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(min(ggra[racon])),ra2kpc(max(ggra[racon])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(ggra,ggdec)
ax2=plt.subplot(224)
plt.plot(gaspeccdist.arcsec, ggga, 'k.', alpha=0.3,markersize=3)
plt.plot(gaspeccdist.arcsec[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=3 ,label='confirmed GCs')
plt.plot(gaspeccdist.arcsec[gaclpec][conta], ggga[gaclpec][conta], 'rx', alpha=1,markersize=5 ,label='contaminant')
ax2.set_xlabel('separation from the nearest GC source',fontsize=15)
ax2.set_ylabel('$(G)(GAIA)$',fontsize=15)
ax2.set_xlim(0,2)
ax2.set_ylim(22,13)
ax2.legend(loc='lower right', frameon=False)

#Check BR excess and AEN
plt.figure(figsize=(19,18*2),frameon=False)
ax2=plt.subplot(421)
ax2.set_ylim(1,20)
ax2.set_xlim(12.5,24)
plt.plot(rpgga, bregga, 'k.', alpha=0.06,markersize=1)
plt.plot(rpgga[gaclpec], bregga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$rp$',fontsize=15)
ax2.set_ylabel('phot_bp_rp_excess_factor',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(422)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
#plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],c
#            ,alpha=1)
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=bregga[gaclpec],marker='x',cmap='inferno_r',vmax=24,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('phot_bp_rp_excess_factor',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)

ax2=plt.subplot(423)
ax2.set_ylim(0,22)
ax2.set_xlim(13,23)
plt.plot(ggga, aengga, 'k.', alpha=0.06,markersize=1)
plt.plot(ggga[gaclpec], aengga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('astrometric_excess_noise',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(424)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=aengga[gaclpec],marker='x',cmap='inferno_r',vmax=23,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('astrometric_excess_noise',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$', fontsize=15)
plt.tight_layout

ax2=plt.subplot(425)
ax2.set_ylim(-300,300)
ax2.set_xlim(5,15.5)
plt.plot(ggga, ra31, 'k.', alpha=0.1,markersize=4)
plt.plot(ggga[gaclpec], ra31[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('radial_velocity (km/s)',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(426)
ax2.set_ylim(-10,10)
ax2.set_xlim(5,22)
plt.plot(ggga, pa31, 'k.', alpha=0.03,markersize=1)
plt.plot(ggga[gaclpec], pa31[gaclpec], 'rx', alpha=1,markersize=6 ,label='contaminant')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('parallax mas',fontsize=15) #1 mas = 1/1000 arcsecond
ax2.legend(loc='upper left', frameon=False)

print(len(ggga[gaclpec])) #detected 205, and have 441 GCs in this data: captured 46%
print(len(ra31))
print('radial velocity for m31 gcs',len(ra31[gaclpec][np.where((ra31[gaclpec]>0)|(ra31[gaclpec]<0))])) #no radial velocity for GCs

print(len(pa31))
print('parallax for m31 GCs',len(pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))]))
print('values of parallax for m31 GCs',pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))])
print('nubmer of identified GCs',len(ggga[gaclpec]))

proj = np.sqrt((ggra-10.6847083)**2+(ggdec-41.26875)**2)*41/3
projga = np.sqrt((ggra[gaclpec]-10.6847083)**2+(ggdec[gaclpec]-41.26875)**2)*41/3
projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.figure(figsize=(8,8),frameon=False)
ax2=plt.subplot(111)
ax2.set_ylim(21.5,15)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(projga, ggga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
plt.plot(projconta, ggga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('R_{proj} (Kpc)',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
#ax2.legend(loc='lower left', frameon=False)
#ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
print('bp',bpgga[gaclpec][conta])
print('rp',rpgga[gaclpec][conta])

"""Wise and Gaia Dr3 lower left"""

import pandas as pd 
wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/m31_lowerleft_wise.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31_lowerleft_GaiaDR3.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra']
ggdec=gaia3['dec']


#print(myFile['ra'])

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,gaiaccd)
cls = wisemtchdist.arcsec<0.75
#    irgc, irgcdist, _ = match_coordinates_sky(iraccd,knowngc)
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,gaiaccd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8

print('#GCs in wise',len(wise2[clpec]))

#&(bregga<20)
#gcgalaxy = (  #(gga-rpga > 0.3+1.1*a-0.29*a*a) & 
                #  (gga-rpga < 0.4*(bpga-gga)+2.45)&
#            (brega>1.7)&(aenga>2.5))   
gcgalaxy = ((aengga>5)&(bpgga-rpgga>1)
            &(bregga>10)#&(bregga<20)
            &(ggga<20.5)
           # &(ggga>16)
          #  &(bpgga-ggga>-3)
            )
# This is awesome! Now do some diagnostic plots, figure out who matched.
    # distance  
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
pgcga = Path([(-0.87,2.3),(-2.,2.8),
          (-3.4,4.4),(-3.5,4.9),
          (-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = (ingcga==True)

#gcgalaxy = ((aengga>5)&(bpgga-rpgga>1)&(bregga>10)&(bregga<20)&(ggga<20.5)&(ggga>16)&(bpgga-ggga>-3))
print('nubmer of candidates (not reduced inner area)',len(ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]))

xyj = np.empty([len(ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]),2]) 
xyj[:,0] = bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]
xyj[:,1] = ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]
pgcwi = Path([(1,4.4),(1.3,4.4),
          (1.3,6.8),(1,6.8),
          (1,4.4)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = (ingcwi==True)

#What is this?
uplong = ( ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi]>9)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
#figure(1).clear()
ax2=plt.subplot(231)
#GAIA Data black
#x2.plot(bpgga-rpgga, ggga, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')

ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1, label='match with WISE')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4,label='GC Candidates')
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G$')
ax2.set_xlim(-1,3.5)
ax2.set_ylim(21,9)
ax2.legend(loc='upper left', frameon=False)


ax2=plt.subplot(232)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.01,markersize=1)
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=1,markersize=4,label='GC candidates (gaia)')
#ax2.plot(bpga[gairmtchi[cls&bigblu[irmtchi]]]-rpga[gairmtchi[cls&bigblu[irmtchi]]], gga[gairmtchi[cls&bigblu[irmtchi]]]-iracmag[cls&bigblu[irmtchi]],'b.', alpha=0.7,markersize=2,label='IRAC candidates')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[3.4]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))

ax2=plt.subplot(233)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.02,markersize=1)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise2[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.6,markersize=2,label='GC candidates (gaia)')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=1,markersize=5,label='GC candidates')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[4.6]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.02,markersize=1)
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise4[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=1,markersize=5,label='GC candidates (gaia)')
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[22]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise3[cls], 'k.', alpha=0.02,markersize=1)
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise3[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong],'gx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[12]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,12)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(236)
ax2.plot(ggra[wisemtchi[cls]], ggdec[wisemtchi[cls]], 'k.', alpha=0.02,markersize=1)
ax2.plot(ggra[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggdec[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'r.', alpha=0.5,markersize=6,label='GC candidates')
#Confirmed GCs
ax2.plot(ggra[wisemtchi[clpec]], ggdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
ax2.plot(ggra[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong], ggdec[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong], 'gx', alpha=0.5,markersize=6,label='GC candidates')
ax2.plot(5,36, 'b.', alpha=1,markersize=7,label='center')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none') uplong
#ax2.set_xlim(9.18470833,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.set_xlim(-3,13)
ax2.set_ylim(min(ggdec),max(ggdec))
ax2.legend(loc='upper left', frameon=False)
plt.tight_layout()

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(min(ggra[wisemtchi[cls]])),ra2kpc(max(ggra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print('number of idnetified confirmed GCs',len(ggra[wispec[clpec]]))

proj = np.sqrt((ggra[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-10.6847083)**2+(ggdec[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-41.26875)**2)*41/3
projcon = np.sqrt((ggra[wisemtchi[clpec]]-10.6847083)**2+(ggdec[wisemtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(21.5,15)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj, ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,14)
ax2.set_xlim(0,230)
plt.plot(proj, ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,ggga[wisemtchi[clpec]]-wise3[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$G$-[12]',fontsize=15)

ax2=plt.subplot(233)
#GAIA Data black
#x2.plot(bpgga-rpgga, ggga, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')

ax2.plot(bpgga[wisemtchi[cls]]-ggga[wisemtchi[cls]], ggga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1, label='match with WISE')
#ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi]-ggga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi], 'rx', alpha=1,markersize=4,label='GC Candidates')
ax2.plot(bpgga[wisemtchi[clpec]]-ggga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4,label='GC Candidates')
ax2.set_xlabel('$(bp-G)$')
ax2.set_ylabel('$G-rp$')
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
#ax2.plot(wise2[cls]-wise3[cls], wise1[cls]-wise2[cls], 'k.', alpha=0.02,markersize=1)
ax2.plot(wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi], wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
ax2.plot(wise2[clpec]-wise3[clpec], wise1[clpec]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong], wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong],'gx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
ax2.set_ylabel('[3.4]-[4.6]')
ax2.set_xlabel('[4.6]-[12]')
ax2.set_xlim(-1,7)
ax2.set_ylim(-1,4)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.set_ylim(0,14)
ax2.set_xlim(0,230)
plt.plot(proj, bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,bpgga[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$BP$-[3.4]',fontsize=15)

plt.tight_layout()

"""G      BP       RP
λ0 

639.07 518.26 782.51 nm


λp 

621.79 510.97 776.91 nm

V 551 nm 

I 149 nm

#SDSS of lower left
"""

fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31ufSDSSdr16radiua_jiamingp.fit')
sdss = fs[1].data
sdsscd3 = SkyCoord(ra=sdss['ra'][:],
                      dec=sdss['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3 = sdsscd3.ravel()
#Less obejcts at fainter mag in this case.
x=(np.log(10)/(-2.5))*sdss['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss['i'] = sdss['i'].ravel()
isd = sdss['i']

x=(np.log(10)/(-2.5))*sdss['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss['g'] = sdss['g'].ravel()
gsd = sdss['g']

x=(np.log(10)/(-2.5))*sdss['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss['r'] = sdss['r'].ravel()
rsd = sdss['r']

x=(np.log(10)/(-2.5))*sdss['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss['u'] = sdss['u'].ravel()
usd = sdss['u']

x=(np.log(10)/(-2.5))*sdss['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss['z'] = sdss['z'].ravel()
zsd = sdss['z']
sdra = sdss['ra']
sddec = sdss['dec']
radu = sdss['petroRad_u']
radg = sdss['petroRad_g']
radr = sdss['petroRad_r']
radi = sdss['petroRad_i']
radz = sdss['petroRad_z']

#PSF magnitude error (I presume)
#erg = sdss['Err_g']
#err = sdss['Err_r']
#eri = sdss['Err_i']
#load in known GCs
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  
#Select known GCs
sdgc, sdgcdist, _ = match_coordinates_sky(sdsscd3,speccald)
sdssgcs = sdgcdist.arcsec<0.6

#candidates
xyp = np.empty([len(rsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd
#field 14

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
gcsd = np.where(ingcsd==True)
sdgccan = np.where((gsd[gcsd]<20)&(radg[gcsd]<7)&(radg[gcsd]>2.5)&(usd[gcsd]<21)&(radu[gcsd]>2.5)&(radu[gcsd]<7)
&(radz[gcsd]>2.5)&(radz[gcsd]<7)&(usd[gcsd]-rsd[gcsd]<2.5)&(gsd[gcsd]-rsd[gcsd]<1)&(gsd[gcsd]-rsd[gcsd]>0.2))

plt.figure(figsize=(19,24),frameon=False)
#CC diagram from SDSS Plot CC of candidates from Subaru and IRAC (or GALEX, SDSS)
ax2=plt.subplot(321)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd-rsd, rsd-isd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#ax2.plot(gnew[uvmtchi[clsuv&starsmall[uvmtchi]]]-inew[uvmtchi[clsuv&starsmall[uvmtchi]]], uvmag[clsuv&starsmall[uvmtchi]], 'r.', alpha=0.4,markersize=2,lw=0, markeredgecolor='none')
#CC of candidates from Subaru red
#ax2.plot(gsd[gcsd&posscand[sdsuba]]-rsd[gcsd&posscand[sdsuba]],rsd[gcsd&posscand[sdsuba]]-isd[gcsd&posscand[sdsuba]], 'r.', alpha=0.4,markersize=4,label='Candidates at Subaru')
#ax2.plot(gsd[gcsd&startf[sdsuba]]-rsd[gcsd&startf[sdsuba]],rsd[gcsd&startf[sdsuba]]-isd[gcsd&startf[sdsuba]], 'y.', alpha=0.45,markersize=3,label='stars')
#CC of candidates from IRAC
#ax2.plot(gsd[gcsd&bigblu[sdsuba]]-rsd[gcsd&bigblu[sdsuba]],rsd[gcsd&bigblu[sdsuba]]-isd[gcsd&bigblu[sdsuba]], 'g.', alpha=1,markersize=4,lw=0, markeredgecolor='none',label='IRAC Candidates')
#ax2.plot(gsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]]-rsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]],rsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]]-isd[gcsd&posscand[sdsuba]&bigblu[sdsuba]], 'g.', alpha=0.8,markersize=5,label='Candidates of Boath Irac and Subaru')
#ax2.plot(gnew[uvmtchi[clsuv&bigblu[sdsuba]]]-inew[uvmtchi[clsuv&bigblu[uvmtchi]]], uvmag[clsuv&bigblu[uvmtchi]], 'g.', alpha=1,markersize=4,lw=0, markeredgecolor='none',label='GALEX Candidates')
#ax2.plot(gsd[gcsd&startf[sdsuba]]-rsd[gcsd&startf[sdsuba]],rsd[gcsd&startf[sdsuba]]-isd[gcsd&startf[sdsuba]], 'y.', alpha=0.45,markersize=3,label='stars')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(r-i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(322)
ax2.plot(usd-rsd, rsd-isd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(usd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(u-r)(SDSS)$')
ax2.set_ylabel('$(r-i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(323)
ax2.plot(gsd-rsd, rsd-zsd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(r-z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(ccy[0],ccy[-1]+1)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(324)
ax2.plot(usd-rsd, rsd-zsd, 'k.', alpha=0.01,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(usd[gcsd][sdgccan]-rsd[gcsd][sdgccan], rsd[gcsd][sdgccan]-zsd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(usd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(u-r)(SDSS)$')
ax2.set_ylabel('$(r-z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcsd,facecolor='none',edgecolor='red',lw=1.5))


m31_ra, m31_dec = Angle('00 42 44.3 hours').deg, \
                  Angle('+41 16 9 degrees').deg
dm31 = 777
def ra2kpc(deg):
    ddeg = (deg-m31_ra)*np.cos(np.pi/180.*m31_dec)            
    return ddeg*np.pi/180. * dm31

ax2=plt.subplot(325)
ax2.plot(sdra, sddec, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#ax2.plot(ggra[wisemtchi[cls]], ggdec[wisemtchi[cls]], 'k.', alpha=0.02,markersize=1)
ax2.plot(sdra[gcsd][sdgccan], sddec[gcsd][sdgccan], 'g.', alpha=1,markersize=7,label='GC candidates')
#Known GCs
ax2.plot(sdra[sdssgcs],sddec[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('ra')
ax2.set_ylabel('dec')
ax2.invert_xaxis()
#ax2.set_xlim(5.68470833,15.68470833) 
#ax2.set_ylim(46.26875,36.26875)
ax2.legend(loc='lower left', frameon=False)
#print('GC candidate',sdra[gcsd][sdgccan], sddec[gcsd][sdgccan])
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sdra)),ra2kpc(min(sdra)))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)

ax2=plt.subplot(326)
ax2.plot(gsd-rsd, isd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], isd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

plt.figure(figsize=(19,24),frameon=False)
ax2=plt.subplot(321)
ax2.plot(gsd-rsd, usd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],usd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], usd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(u)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(322)
ax2.plot(gsd-rsd, zsd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], zsd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(323)
ax2.plot(gsd-rsd, usd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],usd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], usd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(u)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

print('known GCs captured',len(zsd[sdssgcs])) 

plt.figure(figsize=(10,10),frameon=False)
#CC diagram from SDSS Plot CC of candidates from Subaru and IRAC (or GALEX, SDSS)
ax2=plt.subplot(221)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radg, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[gcsd][sdgccan], radg[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(gsd[sdssgcs],radg[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('g  radius$(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(222)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radu, 'k.', alpha=0.02,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[gcsd][sdgccan], radu[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(gsd[sdssgcs],radu[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('u  radius$(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radz, 'k.', alpha=0.02,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[gcsd][sdgccan], radz[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(gsd[sdssgcs],radz[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('z  radius$(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

"""#SDSS WISE Lower Left
one candidate
"""

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/m31_lowerleft_wise.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31ufSDSSdr16radiua_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss31['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss31['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss31['i'] = sdss31['i'].ravel()
isd = sdss31['i']

x=(np.log(10)/(-2.5))*sdss31['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss31['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss31['g'] = sdss31['g'].ravel()
gsd = sdss31['g']

x=(np.log(10)/(-2.5))*sdss31['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss31['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss31['r'] = sdss31['r'].ravel()
rsd = sdss31['r']

x=(np.log(10)/(-2.5))*sdss31['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss31['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss31['u'] = sdss31['u'].ravel()
usd = sdss31['u']

x=(np.log(10)/(-2.5))*sdss31['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss31['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss31['z'] = sdss31['z'].ravel()
zsd = sdss31['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()
radu = sdss31['petroRad_u']
radg = sdss31['petroRad_g']
radr = sdss31['petroRad_r']
radi = sdss31['petroRad_i']
radz = sdss31['petroRad_z']



wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,sdsscd3)
cls = wisemtchdist.arcsec<0.75
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8

L = np.concatenate([ralfcfff,ralf])
print(L)
R = np.concatenate([declfcfff,declf])
for lval,rval in zip(L,R):
   #  print(lval,rval)
     galgccd = SkyCoord(ra=L,dec=R,unit=(u.deg, u.deg))

wilespec, wilespecdist, _ = match_coordinates_sky(galgccd,sdsscd3) 
# find nearest match
wileclpec =  wilespecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,galgccd[wileclpec]) 
# find nearest match
wilpec = wispecdist.arcsec<0.8



#print('#GCs in wise and SDSS',len(wise2[clpec]))

xyp = np.empty([len(gsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
gcsd = ((ingcsd==True)&(gsd<20)&(radg<7)&(radg>2.5)&(usd<21)&(radu>2.5)&(radu<7)
&(radz>2.5)&(radz<7)&(usd-rsd<2.5)&(gsd-rsd<1)&(gsd-rsd>0.2)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)

xyj = np.empty([len(wise2[cls&gcsd[wisemtchi]]),2]) 
xyj[:,1] = rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]]
xyj[:,0] = gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]]

pgcwi = Path([(0.5,2),(0.76,2.84),
          (0.86,2.44),(0.5,1.6),(0.5,2)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = (ingcwi==True)
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])

#M31 GC candidates 1.2556
m31candi = ((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]<1.2557)&(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]>1.2555))
plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi], rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-wise2[cls&gcsd[wisemtchi]][gcwi][m31candi], 'rv', alpha=1,markersize=8,label='GC Candidaets #1')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-[4.6])$')
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise4[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=0.2,markersize=5,label='GC Candidaets')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-wise4[cls&gcsd[wisemtchi]][gcwi][m31candi], 'rv', alpha=1,markersize=8,label='GC Candidaets #1')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[22])$')
ax2.set_xlim(0,7)
ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=0.2,markersize=5,label='GC Candidaets')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-wise1[cls&gcsd[wisemtchi]][gcwi][m31candi], 'rv', alpha=1,markersize=8,label='GC Candidaets #1')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=0.2,markersize=5,label='GC Candidaets')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-wise2[cls&gcsd[wisemtchi]][gcwi][m31candi], 'rv', alpha=1,markersize=8,label='GC Candidaets #1')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[4.6])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=0.2,markersize=5,label='GC Candidaets ')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi]-wise1[cls&gcsd[wisemtchi]][gcwi][m31candi], 'rv', alpha=1,markersize=8,label='GC Candidaets #1')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(236)
ax2.plot(sra[wisemtchi[cls]], sdec[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1)
#ax2.plot(sra[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gdec[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], 'r.', alpha=0.5,markersize=4,label='GC candidates')
ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'r.', alpha=0.3,markersize=7,label='GC candidates')
ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][m31candi], 'rv', alpha=1,markersize=7,label='GC candidates #1')
#Confirmed GCs
ax2.plot(sra[wisemtchi[clpec]], sdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(-2,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.invert_xaxis()
ax2.legend(loc='upper right', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], isd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(usd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-zsd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(usd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]- zsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-r)$')
ax2.set_ylabel('$(r-z)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-10.6847083)**2+(sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-41.26875)**2)*41/3
projcon = np.sqrt((sra[wisemtchi[clpec]]-10.6847083)**2+(sra[wisemtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)

fac = np.where(proj>150)
L = sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fac]
R = sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fac]

for lval,rval in zip(L,R):
     print(lval,rval)

"""#Gaia DR3 center on (6,30)"""

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31GaiaDR3360.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra'][:]
ggdec=gaia3['dec'][:]

#Cut for candidates #2 1.2 #1 1
#gacl=((ggga-rpgga > 0.4*(bpgga-ggga)+1.3)&
#      (ggga-rpgga > -1.3*(bpgga-ggga)+0.6)&(ggga-rpgga < -1.2*(bpgga-ggga)+1.4)&(ggga<20.5)&(ggga-rpgga < -1.05*(bpgga-ggga)+1.4)&(ggga<21))

gaspecc, gaspeccdist, _ = match_coordinates_sky(gaiaccd,speccald) 
# find nearest match 0.8
gaclpec = gaspeccdist.arcsec<0.8


brigga = ((ggga[gaclpec]<21))
smalex = ((bregga[gaclpec]<2))

#possible contaminant 
conta = np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))

a=bpgga-ggga
b=0.3+1.1*a-0.29*a*a
#CC of gaia
#GC candidates in GAIA
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
#field 14

#pgcga = Path([(-0.93,2.3),(-0.93,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.93,2.3)])
#pgcga = Path([(-0.87,2.3),(-0.87,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.87,2.3)])
pgcga = Path([(-0.87,2.3),(-2.,2.8),
          (-3.4,4.4),(-3.5,4.9),
          (-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = np.where(ingcga==True)

gccan = np.where((aengga[gcga]>5)&(bregga[gcga]>2)&(ggga[gcga]<19)&(rpgga[gcga]<17))
contamin = np.where((pa31[gcga]>0)|(pa31[gcga]<0)|(ra31[gcga]>0)|(ra31[gcga]<0))
m31can = np.where((aengga[gcga]>5)&(bpgga[gcga]-rpgga[gcga]>1)&(bregga[gcga]>10)&(bregga[gcga]<20)&(ggga[gcga]<20.5)&(ggga[gcga]>16)&(bpgga[gcga]-ggga[gcga]>-2.4))
#ggrac = np.delete(ggra[gcga][gccan],contamin,axis=0)
#ggdecc = np.delete(ggdec[gcga][gccan],contamin,axis=0)
#bpggac = np.delete(bpgga[gcga][gccan],contamin,axis=0)
#gggac = np.delete(ggga[gcga][gccan],contamin,axis=0)
#rpggac = np.delete(rpgga[gcga][gccan],contamin,axis=0)
plt.figure(figsize=(18,19),frameon=False)
ax2=plt.subplot(221)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
plt.plot(bpgga-ggga, ggga-rpgga, 'k.', alpha=0.01,markersize=1)
plt.plot(bpgga-ggga, b, 'k.', markersize=0.1,label='color edge')
plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='contamin')
ax2.plot(bpgga[gcga][m31can]-ggga[gcga][m31can], ggga[gcga][m31can]-rpgga[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates') #[gcga][m31can]
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
print('bp',bpgga[gaclpec][conta])
print('rp',rpgga[gaclpec][conta])
ax2=plt.subplot(222)
ax2.set_xlim(-2.5,3.5)
ax2.set_ylim(22,10)
plt.plot(bpgga-rpgga, ggga, 'k.', alpha=0.01,markersize=1)
#plt.plot(bpgga[gacl]-rpgga[gacl], ggga[gacl], 'g.', alpha=0.6,markersize=3,label='GC candidates')
plt.plot(bpgga[gaclpec]-rpgga[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.plot(bpggac-rpggac, gggac, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.set_xlabel('$bp-rp$',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
ax2.plot(ggra,ggdec, 'k.', alpha=0.04,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(5,36, 'b.', alpha=1,markersize=3,lw=0, markeredgecolor='none',label='center')
#plt.plot(ggra[gacl], ggdec[gacl], 'g.', alpha=1,markersize=4,label='GC candidates')
ax2.plot(ggra[gaclpec], ggdec[gaclpec], 'bx', alpha=1,markersize=4,label='confirmed GCs')
ax2.plot(ggra[gaclpec][conta], ggdec[gaclpec][conta], 'rx', alpha=1,markersize=5,label='contaminant')
#ax2.plot(ggrac, ggdecc, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.plot(ggra[gcga][m31can],ggdec[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates')
#ax2.plot(ggra[gaclpec][innergc],ggdec[gaclpec][innergc], 'bx', alpha=1,markersize=4)
#ax2.plot(ggra[gaclpec][outergc],ggdec[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.set_xlim(max(ggra),min(ggra)) 
ax2.set_xlim(-3,13)
ax2.set_ylim(min(ggdec),max(ggdec))
ax2.invert_xaxis()
print('number of Candidates',len(ggra[gcga][m31can]))
#ax2.set_xlim(21.68470833,-3.68470833) 
#ax2.set_ylim(25.26875,51.26875)
ax2.legend(loc='lower left', frameon=False)
racon = np.where((ggra<16)&(ggra>-2))
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(min(ggra[racon])),ra2kpc(max(ggra[racon])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(ggra,ggdec)
ax2=plt.subplot(224)
plt.plot(gaspeccdist.arcsec, ggga, 'k.', alpha=0.3,markersize=3)
plt.plot(gaspeccdist.arcsec[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=3 ,label='confirmed GCs')
plt.plot(gaspeccdist.arcsec[gaclpec][conta], ggga[gaclpec][conta], 'rx', alpha=1,markersize=5 ,label='contaminant')
ax2.set_xlabel('separation from the nearest GC source',fontsize=15)
ax2.set_ylabel('$(G)(GAIA)$',fontsize=15)
ax2.set_xlim(0,2)
ax2.set_ylim(22,13)
ax2.legend(loc='lower right', frameon=False)

#Check BR excess and AEN
plt.figure(figsize=(19,18*2),frameon=False)
ax2=plt.subplot(421)
ax2.set_ylim(1,20)
ax2.set_xlim(12.5,24)
plt.plot(rpgga, bregga, 'k.', alpha=0.06,markersize=1)
plt.plot(rpgga[gaclpec], bregga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$rp$',fontsize=15)
ax2.set_ylabel('phot_bp_rp_excess_factor',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(422)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
#plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],c
#            ,alpha=1)
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=bregga[gaclpec],marker='x',cmap='inferno_r',vmax=24,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('phot_bp_rp_excess_factor',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)

ax2=plt.subplot(423)
ax2.set_ylim(0,22)
ax2.set_xlim(13,23)
plt.plot(ggga, aengga, 'k.', alpha=0.06,markersize=1)
plt.plot(ggga[gaclpec], aengga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('astrometric_excess_noise',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(424)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=aengga[gaclpec],marker='x',cmap='inferno_r',vmax=23,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('astrometric_excess_noise',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$', fontsize=15)
plt.tight_layout

ax2=plt.subplot(425)
ax2.set_ylim(-300,300)
ax2.set_xlim(5,15.5)
plt.plot(ggga, ra31, 'k.', alpha=0.1,markersize=4)
plt.plot(ggga[gaclpec], ra31[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('radial_velocity (km/s)',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(426)
ax2.set_ylim(-10,10)
ax2.set_xlim(5,22)
plt.plot(ggga, pa31, 'k.', alpha=0.03,markersize=1)
plt.plot(ggga[gaclpec], pa31[gaclpec], 'rx', alpha=1,markersize=6 ,label='contaminant')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('parallax mas',fontsize=15) #1 mas = 1/1000 arcsecond
ax2.legend(loc='upper left', frameon=False)

print(len(ggga[gaclpec])) #detected 205, and have 441 GCs in this data: captured 46%
print(len(ra31))
print('radial velocity for m31 gcs',len(ra31[gaclpec][np.where((ra31[gaclpec]>0)|(ra31[gaclpec]<0))])) #no radial velocity for GCs

print(len(pa31))
print('parallax for m31 GCs',len(pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))]))
print('values of parallax for m31 GCs',pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))])
print('nubmer of identified GCs',len(ggga[gaclpec]))

proj = np.sqrt((ggra-10.6847083)**2+(ggdec-41.26875)**2)*41/3
projga = np.sqrt((ggra[gaclpec]-10.6847083)**2+(ggdec[gaclpec]-41.26875)**2)*41/3
projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.figure(figsize=(8,8),frameon=False)
ax2=plt.subplot(111)
ax2.set_ylim(21.5,15)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(projga, ggga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
plt.plot(projconta, ggga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('R_{proj} (Kpc)',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
#ax2.legend(loc='lower left', frameon=False)
#ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
print('bp',bpgga[gaclpec][conta])
print('rp',rpgga[gaclpec][conta])

"""#GALEX Gaia DR3"""

#GALEX
fnew = fits.open('/gdrive/My Drive/Astro Research/M31/M31GALEXLLF_jiamingp.fit')
galex = fnew[1].data
galexcd = SkyCoord(ra=galex['ra'][:],
                      dec=galex['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fnew.close()
galexcd = galexcd.ravel()

#Gaia DR3
fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31GaiaDR3360.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra'][:]
ggdec=gaia3['dec'][:]




wisemtchi, wisemtchdist, _ = match_coordinates_sky(galexcd,gaiaccd)
cls = wisemtchdist.arcsec<0.75
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,gaiaccd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(galexcd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8

#GALEX candidate GCs
#galgccd = SkyCoord([(ralf,declf)],
#                      [(ralfcfff,declfcfff)]
#                      ,frame='icrs', unit='deg')
L = np.concatenate([ralfcfff,ralf])
#print(L)
R = np.concatenate([declfcfff,declf])
for lval,rval in zip(L,R):
   #  print(lval,rval)
     galgccd = SkyCoord(ra=L,dec=R,unit=(u.deg, u.deg))

galespec, galespecdist, _ = match_coordinates_sky(galgccd,gaiaccd) 
# find nearest match
galeclpec =  galespecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
gaspec, gaspecdist, _ = match_coordinates_sky(galexcd,galgccd[galeclpec]) 
# find nearest match
galpec = gaspecdist.arcsec<0.8

#plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
#ax2=plt.subplot(231)
#ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
#ax2.set_xlabel('$(g-r)$')
#ax2.set_ylabel('$(r-[4.6])$')
#ax2.set_xlim(-0.5,2.5)
#ax2.set_ylim(0,8)
#ax2.legend(loc='upper left', frameon=False)
#ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])

plt.figure(figsize=(18,19),frameon=False)
ax2=plt.subplot(221)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
plt.plot(bpgga[wisemtchi[cls]]-ggga[wisemtchi[cls]], ggga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], 'k.', alpha=0.1,markersize=1)
#plt.plot(bpgga[wisemtchi[clpec]]-ggga[wisemtchi[clpec]], b[wisemtchi[clpec]], 'k.', markersize=0.1,label='color edge')
#plt.plot(bpgga[wisemtchi[clpec]]-ggga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
plt.plot(bpgga[wisemtchi[galpec]]-ggga[wisemtchi[galpec]], ggga[wisemtchi[galpec]]-rpgga[wisemtchi[galpec]], 'rx', alpha=1,markersize=5 ,label='GALEX GC candidates')
#plt.plot(bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='contamin')
#ax2.plot(bpgga[gcga][m31can]-ggga[gcga][m31can], ggga[gcga][m31can]-rpgga[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates') #[gcga][m31can]
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)
#ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))


ax2=plt.subplot(222)
ax2.set_xlim(-2.5,3.5)
ax2.set_ylim(22,10)
plt.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1)
#plt.plot(bpgga[gacl]-rpgga[gacl], ggga[gacl], 'g.', alpha=0.6,markersize=3,label='GC candidates')
plt.plot(bpgga[wisemtchi[galpec]]-rpgga[wisemtchi[galpec]], ggga[wisemtchi[galpec]], 'rx', alpha=1,markersize=5 ,label='GALEX GC candidates')
#plt.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.plot(bpggac-rpggac, gggac, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.set_xlabel('$bp-rp$',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
ax2.plot(ggra[wisemtchi[cls]],ggdec[wisemtchi[cls]], 'k.', alpha=0.3,markersize=1,lw=0, markeredgecolor='none')
#ax2.plot(5,36, 'b.', alpha=1,markersize=3,lw=0, markeredgecolor='none',label='center')
#plt.plot(ggra[gacl], ggdec[gacl], 'g.', alpha=1,markersize=4,label='GC candidates')
plt.plot(ggra[wisemtchi[galpec]], ggdec[wisemtchi[galpec]], 'rx', alpha=1,markersize=5 ,label='GALEX GC candidates')
ax2.plot(ggra[wisemtchi[clpec]], ggdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='confirmed GCs')
#ax2.plot(ggra[gaclpec][conta], ggdec[gaclpec][conta], 'rx', alpha=1,markersize=5,label='contaminant')
#ax2.plot(ggrac, ggdecc, 'gx', alpha=1,markersize=5,label='GC candidates')
#ax2.plot(ggra[gcga][m31can],ggdec[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates')
#ax2.plot(ggra[gaclpec][innergc],ggdec[gaclpec][innergc], 'bx', alpha=1,markersize=4)
#ax2.plot(ggra[gaclpec][outergc],ggdec[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.set_xlim(max(ggra),min(ggra)) 
ax2.set_xlim(-3,13)
ax2.set_ylim(min(ggdec),max(ggdec))
ax2.invert_xaxis()
#print('number of Candidates',len(ggra[gcga][m31can]))
#ax2.set_xlim(21.68470833,-3.68470833) 
#ax2.set_ylim(25.26875,51.26875)
ax2.legend(loc='lower left', frameon=False)
ggagac = np.where( ggga[wisemtchi[galpec]]-rpgga[wisemtchi[galpec]]>2)
print('good GALEX Gaia GC candidates',ggra[wisemtchi[galpec]][ggagac], ggdec[wisemtchi[galpec]][ggagac])
gagera = ggra[wisemtchi[galpec]][ggagac]
print(np.intersect1d(gawigcra, gagera))

"""#GALEX lower left"""

fnew = fits.open('/gdrive/My Drive/Astro Research/M31/M31GALEXLLa_jiamingp.fit')
galex = fnew[1].data
galexcd = SkyCoord(ra=galex['ra'][:],
                      dec=galex['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fnew.close()
galexcd = galexcd.ravel()

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31ufSDSSdr16radiua_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss31['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss31['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss31['i'] = sdss31['i'].ravel()
isd = sdss31['i']

x=(np.log(10)/(-2.5))*sdss31['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss31['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss31['g'] = sdss31['g'].ravel()
gsd = sdss31['g']

x=(np.log(10)/(-2.5))*sdss31['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss31['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss31['r'] = sdss31['r'].ravel()
rsd = sdss31['r']

x=(np.log(10)/(-2.5))*sdss31['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss31['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss31['u'] = sdss31['u'].ravel()
usd = sdss31['u']

x=(np.log(10)/(-2.5))*sdss31['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss31['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss31['z'] = sdss31['z'].ravel()
zsd = sdss31['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()
radu = sdss31['petroRad_u']
radg = sdss31['petroRad_g']
radr = sdss31['petroRad_r']
radi = sdss31['petroRad_i']
radz = sdss31['petroRad_z']


#Match with SDSS
uvmtchi, uvmtchdist, _ = match_coordinates_sky(galexcd,sdsscd3)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit') # Nelson Caldwell 2016.fit
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(galexcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
uvmag = galex['survey']
uvmag  = uvmag.ravel()

#co = uvmag[clsuv&posscand[uvmtchi]]-gnew[uvmtchi[clsuv&posscand[uvmtchi]]]
#galecand = np.where((co>2.9)&((co>4)|(co<3.3)))
print('identified GCs',len(galpec[clpec]))

xyp = np.empty([len(gsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
#gcsd = ((ingcsd==True)&(gsd<22)&(radg<7)&(radg>2)&(usd<22)&(radu>2)&(radu<7)
#&(radz>2)&(radz<7)&(gsd-rsd<1)&(gsd-rsd>0)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)
gcsd = ((ingcsd==True)&(gsd<22)&(usd<22)&(radz>2)&(radz<7))
#xyj = np.empty([len(uvmag[cls&gcsd[wisemtchi]]),2]) 
#xyj[:,1] = rsd[uvmtchdist[clsuv&gcsd[uvmtchdist]]]-wise2[cls&gcsd[wisemtchi]]
#xyj[:,0] = gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]]

#pgcwi = Path([(0.5,2),(0.76,2.84),
#          (0.86,2.44),(0.5,1.6),(0.5,2)])
#ingcwi = pgcwi.contains_points(xyj) 
#gcwi = (ingcwi==True)
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])

#GC candidate based on Galex color
A = usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]]
B = uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]]
gacan = np.where((uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]]>2.5)&(B>1.58*A-1.18)&(B<1.2*A+1.5))
plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(rsd[uvmtchi[clsuv]]-isd[uvmtchi[clsuv]], uvmag[clsuv]-gsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(rsd[uvmtchi[clpec]]-isd[uvmtchi[clpec]], uvmag[clpec]-gsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(r-i)$')
ax2.set_ylabel('$([nuv]-g)$')
ax2.set_xlim(-2,2)
ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)
#ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(232)
ax2.plot(usd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], uvmag[clsuv]-gsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(usd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], uvmag[clpec]-gsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$([nuv]-g)$')
ax2.set_xlim(-2,7)
ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(233)
ax2.plot(usd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], uvmag[clsuv], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(usd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], uvmag[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$([nuv])$')
ax2.set_xlim(-2,7)
ax2.set_ylim(27,17)
ax2.legend(loc='upper left', frameon=False)
print('identified GCs',len(uvmag[clpec]))

ax2=plt.subplot(234)
ax2.plot(sra[uvmtchi[clsuv]], sdec[uvmtchi[clsuv]], 'k.', alpha=0.07,markersize=1)
#ax2.plot(sra[uvmtchi[clpec]], gdec[uvmtchi[clpec]], 'r.', alpha=0.5,markersize=4,label='GC candidates')
ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]], 'r.', alpha=0.1,markersize=3,label='GC candidates from SDSS')
ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'r.', alpha=1,markersize=7,label='GC candidates')
#Confirmed GCs
ax2.plot(sra[uvmtchi[clpec]], sdec[uvmtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(5,15) 
#ax2.set_ylim(35,47)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(gsd[uvmtchi[clsuv]]-rsd[uvmtchi[clsuv]], isd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], isd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(usd[uvmtchi[clsuv]]-rsd[uvmtchi[clsuv]], rsd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(usd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], rsd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-r)$')
ax2.set_ylabel('$(r-z)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-10.6847083)**2+(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-41.26875)**2)*41/3
projcon = np.sqrt((sra[uvmtchi[clpec]]-10.6847083)**2+(sdec[uvmtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, isd[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)

#Position
ralfcf = sra[uvmtchi[clpec]]
declfcf = sdec[uvmtchi[clpec]]
ralf = sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
declf= sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
projlf = np.sqrt((sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-10.6847083)**2+(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-41.26875)**2)*41/3
projconlf = np.sqrt((sra[uvmtchi[clpec]]-10.6847083)**2+(sdec[uvmtchi[clpec]]-41.26875)**2)*41/3
ilf = isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
ilfcf = isd[uvmtchi[clpec]]
grlf = gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
grlfcf = gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]]
rilf = rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
rilfcf = rsd[uvmtchi[clpec]]-isd[uvmtchi[clpec]]

"""It looks like this GALEX does not have too many far enough GC candidates due to sky coverage

#GALEX lower left more far away
"""

fnew = fits.open('/gdrive/My Drive/Astro Research/M31/M31GALEXLLF_jiamingp.fit')
galex = fnew[1].data
galexcd = SkyCoord(ra=galex['ra'][:],
                      dec=galex['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fnew.close()
galexcd = galexcd.ravel()

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31SDSSdr16LLF_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss31['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss31['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss31['i'] = sdss31['i'].ravel()
isd = sdss31['i']

x=(np.log(10)/(-2.5))*sdss31['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss31['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss31['g'] = sdss31['g'].ravel()
gsd = sdss31['g']

x=(np.log(10)/(-2.5))*sdss31['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss31['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss31['r'] = sdss31['r'].ravel()
rsd = sdss31['r']

x=(np.log(10)/(-2.5))*sdss31['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss31['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss31['u'] = sdss31['u'].ravel()
usd = sdss31['u']

x=(np.log(10)/(-2.5))*sdss31['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss31['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss31['z'] = sdss31['z'].ravel()
zsd = sdss31['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()
radu = sdss31['petroRad_u']
radg = sdss31['petroRad_g']
radr = sdss31['petroRad_r']
radi = sdss31['petroRad_i']
radz = sdss31['petroRad_z']


#Match with SDSS
uvmtchi, uvmtchdist, _ = match_coordinates_sky(galexcd,sdsscd3)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(galexcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
uvmag = galex['survey']
uvmag  = uvmag.ravel()

#co = uvmag[clsuv&posscand[uvmtchi]]-gnew[uvmtchi[clsuv&posscand[uvmtchi]]]
#galecand = np.where((co>2.9)&((co>4)|(co<3.3)))
print('identified GCs',len(galpec[clpec]))

xyp = np.empty([len(gsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4)) (ingcsd==True)&
gcsd = ((ingcsd==True)&(gsd<22)&(radg<7)&(radg>2)&(usd<22)&(radu>2)&(radu<7)
&(radz>2)&(radz<7)&(gsd-rsd<1)&(gsd-rsd>0))
# &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)
#gcsd = ((ingcsd==True)&(gsd<22)&(usd<22)&(radz>2)&(radz<7))
#xyj = np.empty([len(uvmag[cls&gcsd[wisemtchi]]),2]) 
#xyj[:,1] = rsd[uvmtchdist[clsuv&gcsd[uvmtchdist]]]-wise2[cls&gcsd[wisemtchi]]
#xyj[:,0] = gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]]

#pgcwi = Path([(0.5,2),(0.76,2.84),
#          (0.86,2.44),(0.5,1.6),(0.5,2)])
#ingcwi = pgcwi.contains_points(xyj) 
#gcwi = (ingcwi==True)
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])

#GC candidate based on Galex color
A = usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]]
B = uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]]
gacan = np.where((uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]]>2.5)&(B>1.58*A-0.7)&(B<1.2*A+1.5))
plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(rsd[uvmtchi[clsuv]]-isd[uvmtchi[clsuv]], uvmag[clsuv]-gsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(rsd[uvmtchi[clpec]]-isd[uvmtchi[clpec]], uvmag[clpec]-gsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(r-i)$')
ax2.set_ylabel('$([nuv]-g)$')
ax2.set_xlim(-2,2)
ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)
#ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(232)
ax2.plot(usd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], uvmag[clsuv]-gsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(usd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], uvmag[clpec]-gsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$([nuv]-g)$')
ax2.set_xlim(-2,7)
ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(233)
ax2.plot(usd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], uvmag[clsuv], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(usd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], uvmag[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$([nuv])$')
ax2.set_xlim(-2,7)
ax2.set_ylim(27,17)
ax2.legend(loc='upper left', frameon=False)
print('identified GCs',len(uvmag[clpec]))

ax2=plt.subplot(234)
ax2.plot(sra[uvmtchi[clsuv]], sdec[uvmtchi[clsuv]], 'k.', alpha=0.07,markersize=1)
#ax2.plot(sra[uvmtchi[clpec]], gdec[uvmtchi[clpec]], 'r.', alpha=0.5,markersize=4,label='GC candidates')
ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]], 'r.', alpha=0.1,markersize=3,label='GC candidates from SDSS')
ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'r.', alpha=1,markersize=7,label='GC candidates')
ax2.plot(ralf,declf, 'r.', alpha=1,markersize=7)
#Confirmed GCs 
ax2.plot(sra[uvmtchi[clpec]], sdec[uvmtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
ax2.plot(ralfcf, declfcf, 'bx', alpha=1,markersize=5)
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(5,15) 
#ax2.set_ylim(35,47)
ax2.invert_xaxis()
ax2.legend(loc='upper right', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(gsd[uvmtchi[clsuv]]-rsd[uvmtchi[clsuv]], isd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], isd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(usd[uvmtchi[clsuv]]-rsd[uvmtchi[clsuv]], rsd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(usd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], rsd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-r)$')
ax2.set_ylabel('$(r-z)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-10.6847083)**2+(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-41.26875)**2)*41/3
projcon = np.sqrt((sra[uvmtchi[clpec]]-10.6847083)**2+(sdec[uvmtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, isd[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
plt.plot(projlf,ilf, 'rx', alpha=1,markersize=4 )
plt.plot(projconlf, ilfcf, 'bx', alpha=1,markersize=6 )
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
plt.plot(projlf, grlf, 'rx', alpha=1,markersize=4)
plt.plot(projconlf,grlfcf, 'bx', alpha=1,markersize=6 )
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)

ax2=plt.subplot(233)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,rsd[uvmtchi[clpec]]-isd[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
plt.plot(projlf, rilf, 'rx', alpha=1,markersize=4)
plt.plot(projconlf,rilfcf, 'bx', alpha=1,markersize=6 )
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$r-i$',fontsize=15)

ralfcfff =sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
declfcfff = sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]


disgegc = np.where(proj>150)
print('most distant GALEX GC candidates')
L = sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
R = sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]

for lval,rval in zip(L,R):
     print(lval,rval)

"""#GALEX WISE"""

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/wiseM31GALEXLL_JP.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31SDSSdr16LRfar_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss31['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss31['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss31['i'] = sdss31['i'].ravel()
isd = sdss31['i']

x=(np.log(10)/(-2.5))*sdss31['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss31['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss31['g'] = sdss31['g'].ravel()
gsd = sdss31['g']

x=(np.log(10)/(-2.5))*sdss31['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss31['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss31['r'] = sdss31['r'].ravel()
rsd = sdss31['r']

x=(np.log(10)/(-2.5))*sdss31['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss31['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss31['u'] = sdss31['u'].ravel()
usd = sdss31['u']

x=(np.log(10)/(-2.5))*sdss31['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss31['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss31['z'] = sdss31['z'].ravel()
zsd = sdss31['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()
radu = sdss31['petroRad_u']
radg = sdss31['petroRad_g']
radr = sdss31['petroRad_r']
radi = sdss31['petroRad_i']
radz = sdss31['petroRad_z']



wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,sdsscd3)
cls = wisemtchdist.arcsec<0.75
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8

L = np.concatenate([ralfcfff,ralf])
#print(L)
R = np.concatenate([declfcfff,declf])
for lval,rval in zip(L,R):
   #  print(lval,rval)
     galgccd = SkyCoord(ra=L,dec=R,unit=(u.deg, u.deg))

wilespec, wilespecdist, _ = match_coordinates_sky(galgccd,sdsscd3) 
# find nearest match
wileclpec =  wilespecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,galgccd[wileclpec]) 
# find nearest match
wilpec = wispecdist.arcsec<0.8

xyp = np.empty([len(gsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
gcsd = ((ingcsd==True)&(gsd<20)&(radg<7)&(radg>2.5)&(usd<21)&(radu>2.5)&(radu<7)
&(radz>2.5)&(radz<7)&(usd-rsd<2.5)&(gsd-rsd<1)&(gsd-rsd>0.2)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)
galsd = ((ingcsd==True))
xyj = np.empty([len(wise2[cls&gcsd[wisemtchi]]),2]) 
xyj[:,1] = rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]]
xyj[:,0] = gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]]

pgcwi = Path([(0.5,2),(0.76,2.84),
          (0.86,2.44),(0.5,1.6),(0.5,2)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = (ingcwi==True)
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])
xyj = np.empty([len(gsd[wisemtchi[wilpec]]),2]) 
xyj[:,1] = rsd[wisemtchi[wilpec]]-wise2[wilpec]
xyj[:,0] = gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]]

pgcwii = Path([(0.5,2),(0.76,2.84),
          (0.86,2.44),(0.5,1.6),(0.5,2)])
ingcwii = pgcwii.contains_points(xyj) 
gcwiga = (ingcwii==True)

plt.figure(figsize=(18*1.8,9*1.8),frameon=False)  
ax2=plt.subplot(231)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], rsd[wisemtchi[wilpec]]-wise2[wilpec], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-[4.6])$')
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise4[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-isd[wisemtchi[wilpec]], isd[wisemtchi[wilpec]]-wise4[wilpec], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[22])$')
ax2.set_xlim(0,7)
ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-isd[wisemtchi[wilpec]], isd[wisemtchi[wilpec]]-wise1[wilpec], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-zsd[wisemtchi[wilpec]], zsd[wisemtchi[wilpec]]-wise2[wilpec], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[4.6])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-zsd[wisemtchi[wilpec]], zsd[wisemtchi[wilpec]]-wise1[wilpec], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets ')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(236)
ax2.plot(sra[wisemtchi[cls]], sdec[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1)
#ax2.plot(sra[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gdec[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'r.', alpha=1,markersize=7,label='GC candidates')
#Confirmed GCs
ax2.plot(sra[wisemtchi[clpec]], sdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
ax2.plot(sra[wisemtchi[wilpec]][gcwiga], sdec[wisemtchi[wilpec]][gcwiga], 'gx', alpha=1,markersize=5,label='Confirmed GCs WISE')
ax2.plot(sra[wisemtchi[wilpec]], sdec[wisemtchi[wilpec]], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(-2,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)
print('confirmed GCs',sra[wisemtchi[clpec]], sdec[wisemtchi[clpec]])
print('GC candidates in both GALEX and WISE',sra[wisemtchi[wilpec]][gcwiga], sdec[wisemtchi[wilpec]][gcwiga])
gawigcra = sra[wisemtchi[wilpec]][gcwiga]
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.figure(figsize=(8,8),frameon=False)  
ax2=plt.subplot(111)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], wise1[cls]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], wise1[clpec]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], wise1[wilpec]-wise2[wilpec], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$([3.4]-[4.6])$')
#ax2.set_xlim(-0.5,2.5)
#ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], isd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], isd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=5,label='GC Candidaets GALEX')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(usd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-zsd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(usd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]- zsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], rsd[wisemtchi[wilpec]]-zsd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=5,label='GC Candidaets GALEX')
ax2.set_xlabel('$(u-r)$')
ax2.set_ylabel('$(r-z)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[wisemtchi[wilpec]]-10.6847083)**2+(sdec[wisemtchi[wilpec]]-41.26875)**2)*41/3
projgal = np.sqrt((sra[wisemtchi[wilpec]][gcwiga]-10.6847083)**2+(sdec[wisemtchi[wilpec]][gcwiga]-41.26875)**2)*41/3
projcon = np.sqrt((sra[wisemtchi[clpec]]-10.6847083)**2+(sra[wisemtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,isd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=4 ,label='GC Candidates') 
plt.plot(projgal,isd[wisemtchi[wilpec]][gcwiga], 'gx', alpha=1,markersize=7 ,label='GC Candidates selected by IRAC')
plt.plot(projcon, isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
#ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, rsd[wisemtchi[wilpec]]-wise2[wilpec], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projgal,rsd[wisemtchi[wilpec]][gcwiga]-wise2[wilpec][gcwiga], 'gx', alpha=1,markersize=7 ,label='GC Candidates selected by IRAC')
plt.plot(projcon,rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$r-[4.6]$',fontsize=15)


ax2=plt.subplot(233)
#ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projgal,gsd[wisemtchi[wilpec]][gcwiga]-rsd[wisemtchi[wilpec]][gcwiga], 'gx', alpha=1,markersize=7 ,label='GC Candidates selected by IRAC')
plt.plot(projcon,gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)

"""#Upper left Circle of M31 (5,51)"""

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31_upleft_gaiadr3.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra'][:]
ggdec=gaia3['dec'][:]

#Cut for candidates #2 1.2 #1 1
#gacl=((ggga-rpgga > 0.4*(bpgga-ggga)+1.3)&
#      (ggga-rpgga > -1.3*(bpgga-ggga)+0.6)&(ggga-rpgga < -1.2*(bpgga-ggga)+1.4)&(ggga<20.5)&(ggga-rpgga < -1.05*(bpgga-ggga)+1.4)&(ggga<21))

gaspecc, gaspeccdist, _ = match_coordinates_sky(gaiaccd,speccald) 
# find nearest match 0.8
gaclpec = gaspeccdist.arcsec<0.8


brigga = ((ggga[gaclpec]<21))
smalex = ((bregga[gaclpec]<2))

#possible contaminant 
conta = np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))

a=bpgga-ggga
b=0.3+1.1*a-0.29*a*a
#CC of gaia
#GC candidates in GAIA
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
#field 14

#pgcga = Path([(-0.93,2.3),(-0.93,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.93,2.3)])
pgcga = Path([(-0.87,2.3),(-0.87,2.3),
          (0,1.4),(-0.2,1.3),
          (-0.6,1.5),(-1.15,2.1),(-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = np.where(ingcga==True)

gccan = np.where((aengga[gcga]>5)&(bregga[gcga]>2)&(ggga[gcga]<19)&(rpgga[gcga]<17))
contamin = np.where((pa31[gcga]>0)|(pa31[gcga]<0)|(ra31[gcga]>0)|(ra31[gcga]<0))
#ggrac = np.delete(ggra[gcga][gccan],contamin,axis=0)
#ggdecc = np.delete(ggdec[gcga][gccan],contamin,axis=0)
#bpggac = np.delete(bpgga[gcga][gccan],contamin,axis=0)
#gggac = np.delete(ggga[gcga][gccan],contamin,axis=0)
#rpggac = np.delete(rpgga[gcga][gccan],contamin,axis=0)
plt.figure(figsize=(18,19),frameon=False)
ax2=plt.subplot(221)
ax2.set_ylim(-0.5,6)
ax2.set_xlim(-4.5,2)
plt.plot(bpgga-ggga, ggga-rpgga, 'k.', alpha=0.01,markersize=1)
plt.plot(bpgga-ggga, b, 'k.', markersize=0.1,label='color edge')
plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
plt.plot(bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
#print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
#print('bp',bpgga[gaclpec][conta])
#print('rp',rpgga[gaclpec][conta])
ax2=plt.subplot(222)
ax2.set_xlim(-2.5,3.5)
ax2.set_ylim(22,10)
plt.plot(bpgga-rpgga, ggga, 'k.', alpha=0.01,markersize=1)
#plt.plot(bpgga[gacl]-rpgga[gacl], ggga[gacl], 'g.', alpha=0.6,markersize=3,label='GC candidates')
plt.plot(bpgga[gaclpec]-rpgga[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.plot(bpggac-rpggac, gggac, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.set_xlabel('$bp-rp$',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
ax2.plot(ggra,ggdec, 'k.', alpha=0.04,markersize=1,lw=0, markeredgecolor='none')
#plt.plot(ggra[gacl], ggdec[gacl], 'g.', alpha=1,markersize=4,label='GC candidates')
ax2.plot(ggra[gaclpec], ggdec[gaclpec], 'bx', alpha=1,markersize=4,label='confirmed GCs')
ax2.plot(ggra[gaclpec][conta], ggdec[gaclpec][conta], 'rx', alpha=1,markersize=5,label='contaminant')
#ax2.plot(ggrac, ggdecc, 'gx', alpha=1,markersize=5,label='GC candidates')
#ax2.plot(ggra[gaclpec][innergc],ggdec[gaclpec][innergc], 'bx', alpha=1,markersize=4)
#ax2.plot(ggra[gaclpec][outergc],ggdec[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.set_xlim(min(ggra),max(ggra)) 
#ax2.set_ylim(min(ggdec),max(ggdec))
ax2.set_xlim(12,-3.68470833) 
ax2.set_ylim(38,60)
ax2.legend(loc='lower left', frameon=False)
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(min(ggra)),ra2kpc(max(ggra)))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(ggra,ggdec)
ax2=plt.subplot(224)
plt.plot(gaspeccdist.arcsec, ggga, 'k.', alpha=0.3,markersize=3)
plt.plot(gaspeccdist.arcsec[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=3 ,label='confirmed GCs')
plt.plot(gaspeccdist.arcsec[gaclpec][conta], ggga[gaclpec][conta], 'rx', alpha=1,markersize=5 ,label='contaminant')
ax2.set_xlabel('separation from the nearest GC source',fontsize=15)
ax2.set_ylabel('$(G)(GAIA)$',fontsize=15)
ax2.set_xlim(0,2)
ax2.set_ylim(22,13)
ax2.legend(loc='lower right', frameon=False)

#Check BR excess and AEN
plt.figure(figsize=(19,18*2),frameon=False)
ax2=plt.subplot(421)
ax2.set_ylim(1,6)
ax2.set_xlim(12.5,21)
plt.plot(rpgga, bregga, 'k.', alpha=0.06,markersize=1)
plt.plot(rpgga[gaclpec], bregga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$rp$',fontsize=15)
ax2.set_ylabel('phot_bp_rp_excess_factor',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(422)
ax2.set_ylim(-0.5,3)
ax2.set_xlim(-1.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
#plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],c
#            ,alpha=1)
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=bregga[gaclpec],marker='x',cmap='inferno_r',vmax=5,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('phot_bp_rp_excess_factor',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)

ax2=plt.subplot(423)
ax2.set_ylim(0,22)
ax2.set_xlim(13,21)
plt.plot(ggga, aengga, 'k.', alpha=0.06,markersize=1)
plt.plot(ggga[gaclpec], aengga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('astrometric_excess_noise',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(424)
ax2.set_ylim(-0.5,3)
ax2.set_xlim(-1.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=aengga[gaclpec],marker='x',cmap='inferno_r',vmax=20,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('astrometric_excess_noise',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$', fontsize=15)
plt.tight_layout

ax2=plt.subplot(425)
ax2.set_ylim(-300,300)
ax2.set_xlim(5,15.5)
plt.plot(ggga, ra31, 'k.', alpha=1,markersize=4)
plt.plot(ggga[gaclpec], ra31[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('radial_velocity (km/s)',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(426)
ax2.set_ylim(-10,10)
ax2.set_xlim(5,22)
plt.plot(ggga, pa31, 'k.', alpha=0.03,markersize=1)
plt.plot(ggga[gaclpec], pa31[gaclpec], 'rx', alpha=1,markersize=6 ,label='contaminant')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('parallax mas',fontsize=15) #1 mas = 1/1000 arcsecond
ax2.legend(loc='upper left', frameon=False)

#print(len(ggga[gaclpec]))
#print(len(ra31))
#print('radial velocity for m31 gcs',len(ra31[gaclpec][np.where((ra31[gaclpec]>0)|(ra31[gaclpec]<0))])) #no radial velocity for GCs

#print(len(pa31))
#print('parallax for m31 GCs',len(pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))]))
#print('values of parallax for m31 GCs',pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))])
print('nubmer of identified GCs',len(ggga[gaclpec]))

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31_upleft_gaiadr3.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra'][:]
ggdec=gaia3['dec'][:]

#Cut for candidates #2 1.2 #1 1
#gacl=((ggga-rpgga > 0.4*(bpgga-ggga)+1.3)&
#      (ggga-rpgga > -1.3*(bpgga-ggga)+0.6)&(ggga-rpgga < -1.2*(bpgga-ggga)+1.4)&(ggga<20.5)&(ggga-rpgga < -1.05*(bpgga-ggga)+1.4)&(ggga<21))

gaspecc, gaspeccdist, _ = match_coordinates_sky(gaiaccd,speccald) 
# find nearest match 0.8
gaclpec = gaspeccdist.arcsec<0.8


brigga = ((ggga[gaclpec]<21))
smalex = ((bregga[gaclpec]<2))

#possible contaminant 
conta = np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))

a=bpgga-ggga
b=0.3+1.1*a-0.29*a*a
#CC of gaia
#GC candidates in GAIA
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
#field 14

#pgcga = Path([(-0.93,2.3),(-0.93,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.93,2.3)])
#pgcga = Path([(-0.87,2.3),(-0.87,2.3),
#          (0,1.4),(-0.2,1.3),
#          (-0.6,1.5),(-1.15,2.1),(-0.87,2.3)])
pgcga = Path([(-0.87,2.3),(-2.,2.8),
          (-3.4,4.4),(-3.5,4.9),
          (-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = np.where(ingcga==True)

gccan = np.where((aengga[gcga]>5)&(bregga[gcga]>2)&(ggga[gcga]<19)&(rpgga[gcga]<17))
contamin = np.where((pa31[gcga]>0)|(pa31[gcga]<0)|(ra31[gcga]>0)|(ra31[gcga]<0))
#m31can = np.where((aengga[gcga]>5)&(bpgga[gcga]-rpgga[gcga]>1)&(bregga[gcga]>10)&(bregga[gcga]<20)&(ggga[gcga]<21)&(ggga[gcga]>16)&(bpgga[gcga]-ggga[gcga]>-2.4))
m31can = np.where((aengga[gcga]>5)&(bpgga[gcga]-rpgga[gcga]>0.9)&(bregga[gcga]>10)&(ggga[gcga]<21)&(ggga[gcga]>13))
#ggrac = np.delete(ggra[gcga][gccan],contamin,axis=0)
#ggdecc = np.delete(ggdec[gcga][gccan],contamin,axis=0)
#bpggac = np.delete(bpgga[gcga][gccan],contamin,axis=0)
#gggac = np.delete(ggga[gcga][gccan],contamin,axis=0)
#rpggac = np.delete(rpgga[gcga][gccan],contamin,axis=0)
plt.figure(figsize=(18,19),frameon=False)
ax2=plt.subplot(221)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
plt.plot(bpgga-ggga, ggga-rpgga, 'k.', alpha=0.01,markersize=1)
plt.plot(bpgga-ggga, b, 'k.', markersize=0.1,label='color edge')
plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
plt.plot(bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.plot(bpgga[gcga][m31can]-ggga[gcga][m31can], ggga[gcga][m31can]-rpgga[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates') #[gcga][m31can]
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcga,facecolor='none',edgecolor='red',lw=1.5))
print('bp-g and g-rp',bpgga[gaclpec][conta]-ggga[gaclpec][conta], ggga[gaclpec][conta]-rpgga[gaclpec][conta])
print('bp',bpgga[gaclpec][conta])
print('rp',rpgga[gaclpec][conta])
ax2=plt.subplot(222)
ax2.set_xlim(-2.5,3.5)
ax2.set_ylim(22,10)
plt.plot(bpgga-rpgga, ggga, 'k.', alpha=0.01,markersize=1)
#plt.plot(bpgga[gacl]-rpgga[gacl], ggga[gacl], 'g.', alpha=0.6,markersize=3,label='GC candidates')
plt.plot(bpgga[gaclpec]-rpgga[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=5 ,label='confirmed GCs')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#plt.plot(bpgga[gaclpec][outergc]-rpgga[gaclpec][outergc], ggga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.plot(bpggac-rpggac, gggac, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.set_xlabel('$bp-rp$',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
ax2.plot(ggra,ggdec, 'k.', alpha=0.04,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(10.6847083,41.26875, 'b.', alpha=1,markersize=10,label='M31 center')
#plt.plot(ggra[gacl], ggdec[gacl], 'g.', alpha=1,markersize=4,label='GC candidates')
ax2.plot(ggra[gaclpec], ggdec[gaclpec], 'bx', alpha=1,markersize=4,label='confirmed GCs')
ax2.plot(ggra[gaclpec][conta], ggdec[gaclpec][conta], 'rx', alpha=1,markersize=5,label='contaminant')
#ax2.plot(ggrac, ggdecc, 'gx', alpha=1,markersize=5,label='GC candidates')
ax2.plot(ggra[gcga][m31can],ggdec[gcga][m31can], 'g.', alpha=0.7,markersize=4,label='GC candidates')
#ax2.plot(ggra[gaclpec][innergc],ggdec[gaclpec][innergc], 'bx', alpha=1,markersize=4)
#ax2.plot(ggra[gaclpec][outergc],ggdec[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
#ax2.set_xlim(max(ggra),min(ggra)) 
ax2.set_xlim(-3,13)
ax2.set_ylim(38,max(ggdec))
print('number of Candidates',len(ggra[gcga][m31can]))
#ax2.set_xlim(21.68470833,-3.68470833) 
#ax2.set_ylim(25.26875,51.26875)
ax2.legend(loc='lower left', frameon=False)
racon = np.where((ggra<16)&(ggra>-2))
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(min(ggra[racon])),ra2kpc(max(ggra[racon])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(ggra,ggdec)
ax2=plt.subplot(224)
plt.plot(gaspeccdist.arcsec, ggga, 'k.', alpha=0.3,markersize=3)
plt.plot(gaspeccdist.arcsec[gaclpec], ggga[gaclpec], 'bx', alpha=1,markersize=3 ,label='confirmed GCs')
plt.plot(gaspeccdist.arcsec[gaclpec][conta], ggga[gaclpec][conta], 'rx', alpha=1,markersize=5 ,label='contaminant')
ax2.set_xlabel('separation from the nearest GC source',fontsize=15)
ax2.set_ylabel('$(G)(GAIA)$',fontsize=15)
ax2.set_xlim(0,2)
ax2.set_ylim(22,13)
ax2.legend(loc='lower right', frameon=False)

#Check BR excess and AEN
plt.figure(figsize=(19,18*2),frameon=False)
ax2=plt.subplot(421)
ax2.set_ylim(1,20)
ax2.set_xlim(12.5,24)
plt.plot(rpgga, bregga, 'k.', alpha=0.06,markersize=1)
plt.plot(rpgga[gaclpec], bregga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$rp$',fontsize=15)
ax2.set_ylabel('phot_bp_rp_excess_factor',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(422)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
#plt.plot(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],c
#            ,alpha=1)
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=bregga[gaclpec],marker='x',cmap='inferno_r',vmax=24,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('phot_bp_rp_excess_factor',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$',fontsize=15)

ax2=plt.subplot(423)
ax2.set_ylim(0,22)
ax2.set_xlim(13,23)
plt.plot(ggga, aengga, 'k.', alpha=0.06,markersize=1)
plt.plot(ggga[gaclpec], aengga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('astrometric_excess_noise',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(424)
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.scatter(bpgga-ggga, ggga-rpgga, color='black', alpha=0.01,s=1)
plt.plot(bpgga-ggga, b, 'k.', alpha=0.01,markersize=0.1,label='color edge')
sc = ax2.scatter(bpgga[gaclpec]-ggga[gaclpec], ggga[gaclpec]-rpgga[gaclpec],
            c=aengga[gaclpec],marker='x',cmap='inferno_r',vmax=23,vmin=0,
                s=20,edgecolor='none',alpha=1)

divider = make_axes_locatable(ax2)
cax = divider.append_axes("right", "5%")
cbar = plt.colorbar(sc,cax=cax)
cbar.ax.tick_params(labelsize=22)

cbar.set_label('astrometric_excess_noise',fontsize=15,
             rotation=270.,ha='center',va='center',
               labelpad=20)
cbar.solids.set(alpha=1)
ax2.set_xlabel('$bp-G$',fontsize=15)
ax2.set_ylabel('$G-rp$', fontsize=15)
plt.tight_layout

ax2=plt.subplot(425)
ax2.set_ylim(-300,300)
ax2.set_xlim(5,15.5)
plt.plot(ggga, ra31, 'k.', alpha=0.1,markersize=4)
plt.plot(ggga[gaclpec], ra31[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('radial_velocity (km/s)',fontsize=15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(426)
ax2.set_ylim(-10,10)
ax2.set_xlim(5,22)
plt.plot(ggga, pa31, 'k.', alpha=0.03,markersize=1)
plt.plot(ggga[gaclpec], pa31[gaclpec], 'rx', alpha=1,markersize=6 ,label='contaminant')
ax2.set_xlabel('$G$',fontsize=15)
ax2.set_ylabel('parallax mas',fontsize=15) #1 mas = 1/1000 arcsecond
ax2.legend(loc='upper left', frameon=False)

print(len(ggga[gaclpec])) #detected 205, and have 441 GCs in this data: captured 46%
print(len(ra31))
print('radial velocity for m31 gcs',len(ra31[gaclpec][np.where((ra31[gaclpec]>0)|(ra31[gaclpec]<0))])) #no radial velocity for GCs

print(len(pa31))
print('parallax for m31 GCs',len(pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))]))
print('values of parallax for m31 GCs',pa31[gaclpec][np.where((pa31[gaclpec]>0)|(pa31[gaclpec]<0))])
print('nubmer of identified GCs',len(ggga[gaclpec]))

proj = np.sqrt((ggra-10.6847083)**2+(ggdec-41.26875)**2)*41/3
projga = np.sqrt((ggra[gaclpec]-10.6847083)**2+(ggdec[gaclpec]-41.26875)**2)*41/3
projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.figure(figsize=(8,8),frameon=False)
ax2=plt.subplot(111)
ax2.set_ylim(21.5,15)
ax2.set_xlim(100,260)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(projga, ggga[gaclpec], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
plt.plot(projconta, ggga[gaclpec][conta], 'rx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('R_{proj} (Kpc)',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)

"""#WISE Gaia Upper Left"""

import pandas as pd 
wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/M31_upperleft_WISE.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

fgag = fits.open('/gdrive/My Drive/Astro Research/M31/M31_upleft_gaiadr3.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra']
ggdec=gaia3['dec']

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,gaiaccd)
cls = wisemtchdist.arcsec<0.75

gcgalaxy = ((aengga>5)&(bpgga-rpgga>1)
            &(bregga>10)#&(bregga<20)
            &(ggga<21)
           # &(ggga>16)
          #  &(bpgga-ggga>-3)
            )
# This is awesome! Now do some diagnostic plots, figure out who matched.
    # distance  
xyp = np.empty([len(ggga),2]) 
xyp[:,0] = bpgga-ggga
xyp[:,1] = ggga-rpgga
pgcga = Path([(-0.87,2.3),(-2.,2.8),
          (-3.4,4.4),(-3.5,4.9),
          (-0.87,2.3)])
ingcga = pgcga.contains_points(xyp) 
gcga = (ingcga==True)

#gcgalaxy = ((aengga>5)&(bpgga-rpgga>1)&(bregga>10)&(bregga<20)&(ggga<20.5)&(ggga>16)&(bpgga-ggga>-3))
print('nubmer of candidates (not reduced inner area)',len(ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]))

xyj = np.empty([len(ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]),2]) 
xyj[:,0] = bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]
xyj[:,1] = ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]
pgcwi = Path([(1,4.4),(1.5,4.4),
          (1.5,8.1),(1,8.1),
          (1,4.4)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = (ingcwi==True)

#What is this?
uplong = ( ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi]>9)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
#figure(1).clear()
ax2=plt.subplot(231)
#GAIA Data black
#x2.plot(bpgga-rpgga, ggga, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')

ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1, label='match with WISE')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4,label='GC Candidates')
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G$')
ax2.set_xlim(-1,3.5)
ax2.set_ylim(21,9)
ax2.legend(loc='upper left', frameon=False)


ax2=plt.subplot(232)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.01,markersize=1)
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=1,markersize=4,label='GC candidates (gaia)')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]],'r.', alpha=1,markersize=5,label='GC candidates Gaia')
#ax2.plot(bpga[gairmtchi[cls&bigblu[irmtchi]]]-rpga[gairmtchi[cls&bigblu[irmtchi]]], gga[gairmtchi[cls&bigblu[irmtchi]]]-iracmag[cls&bigblu[irmtchi]],'b.', alpha=0.7,markersize=2,label='IRAC candidates')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[3.4]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))

ax2=plt.subplot(233)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.02,markersize=1)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise2[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.6,markersize=2,label='GC candidates (gaia)')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=1,markersize=5,label='GC candidates')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]],'r.', alpha=1,markersize=5,label='GC candidates Gaia')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[4.6]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.02,markersize=1)
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise4[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=1,markersize=5,label='GC candidates (gaia)')
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[22]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,15)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise3[cls], 'k.', alpha=0.02,markersize=1)
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise3[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong],'gx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-[12]$')
ax2.set_xlim(-0.5,4)
ax2.set_ylim(0,12)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(236)
ax2.plot(ggra[wisemtchi[cls]], ggdec[wisemtchi[cls]], 'k.', alpha=0.02,markersize=1)
ax2.plot(ggra[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggdec[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'r.', alpha=0.5,markersize=6,label='GC candidates')
#Confirmed GCs
#ax2.plot(ggra[wisemtchi[clpec]], ggdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
ax2.plot(ggra[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong], ggdec[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi][uplong], 'gx', alpha=0.5,markersize=6,label='GC candidates')
ax2.plot(5,36, 'b.', alpha=1,markersize=7,label='center')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none') uplong
#ax2.set_xlim(9.18470833,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.set_xlim(-3,13)
ax2.set_ylim(min(ggdec),max(ggdec))
ax2.legend(loc='upper left', frameon=False)
plt.tight_layout()

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(min(ggra[wisemtchi[cls]])),ra2kpc(max(ggra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print('number of idnetified confirmed GCs',len(ggra[wispec[clpec]]))

proj = np.sqrt((ggra[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-10.6847083)**2+(ggdec[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-41.26875)**2)*41/3
#projcon = np.sqrt((ggra[wisemtchi[clpec]]-10.6847083)**2+(ggdec[wisemtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(21.5,15)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj, ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
#plt.plot(projcon, ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$G$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,14)
ax2.set_xlim(0,230)
plt.plot(proj, ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
#plt.plot(projcon,ggga[wisemtchi[clpec]]-wise3[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$G$-[12]',fontsize=15)

ax2=plt.subplot(233)
#GAIA Data black
#x2.plot(bpgga-rpgga, ggga, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')

ax2.plot(bpgga[wisemtchi[cls]]-ggga[wisemtchi[cls]], ggga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1, label='match with WISE')
#ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi]-ggga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcga][gcwi], 'rx', alpha=1,markersize=4,label='GC Candidates')
#ax2.plot(bpgga[wisemtchi[clpec]]-ggga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], ggga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-rpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4,label='GC Candidates')
ax2.set_xlabel('$(bp-G)$')
ax2.set_ylabel('$G-rp$')
ax2.set_ylim(-0.5,7)
ax2.set_xlim(-5.5,2)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
#ax2.plot(wise2[cls]-wise3[cls], wise1[cls]-wise2[cls], 'k.', alpha=0.02,markersize=1)
ax2.plot(wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi], wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi],'rx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
#ax2.plot(wise2[clpec]-wise3[clpec], wise1[clpec]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong]-wise3[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong], wise1[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi][uplong],'gx', alpha=0.8,markersize=5,label='GC candidates (gaia)')
ax2.set_ylabel('[3.4]-[4.6]')
ax2.set_xlabel('[4.6]-[12]')
ax2.set_xlim(-1,7)
ax2.set_ylim(-1,4)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.set_ylim(0,14)
ax2.set_xlim(0,230)
plt.plot(proj, bpgga[wisemtchi[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]]][gcwi]-wise2[cls&gcgalaxy[wisemtchi]&gcga[wisemtchi]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
# plt.plot(projcon,bpgga[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$BP$-[3.4]',fontsize=15)

plt.tight_layout()

"""#SDSS M31 cluster"""

fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31SDSSdr16cluster2_jiamingp.fit')
sdss = fs[1].data
sdsscd3 = SkyCoord(ra=sdss['ra'][:],
                      dec=sdss['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3 = sdsscd3.ravel()
#Less obejcts at fainter mag in this case.
x=(np.log(10)/(-2.5))*sdss['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss['i'] = sdss['i'].ravel()
isd = sdss['i']

x=(np.log(10)/(-2.5))*sdss['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss['g'] = sdss['g'].ravel()
gsd = sdss['g']

x=(np.log(10)/(-2.5))*sdss['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss['r'] = sdss['r'].ravel()
rsd = sdss['r']

x=(np.log(10)/(-2.5))*sdss['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss['u'] = sdss['u'].ravel()
usd = sdss['u']

x=(np.log(10)/(-2.5))*sdss['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss['z'] = sdss['z'].ravel()
zsd = sdss['z']
sdra = sdss['ra']
sddec = sdss['dec']
radu = sdss['petroRad_u']
radg = sdss['petroRad_g']
radr = sdss['petroRad_r']
radi = sdss['petroRad_i']
radz = sdss['petroRad_z']

#PSF magnitude error (I presume)
#erg = sdss['Err_g']
#err = sdss['Err_r']
#eri = sdss['Err_i']
#load in known GCs
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
print(caldwell)
fm31.close()
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs')  
#Select known GCs
sdgc, sdgcdist, _ = match_coordinates_sky(sdsscd3,speccald)
sdssgcs = sdgcdist.arcsec<0.6

#candidates
xyp = np.empty([len(rsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd
#field 14

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
gcsd = np.where(ingcsd==True)
sdgccan = np.where((gsd[gcsd]<20)&(radg[gcsd]<7)&(radg[gcsd]>2.5)&(usd[gcsd]<21)&(radu[gcsd]>2.5)&(radu[gcsd]<7)
&(radz[gcsd]>2.5)&(radz[gcsd]<7)&(usd[gcsd]-rsd[gcsd]<2.5)&(gsd[gcsd]-rsd[gcsd]<1)&(gsd[gcsd]-rsd[gcsd]>0.2))

proj = np.sqrt((sdra[sdssgcs]-10.6847083)**2+(sddec[sdssgcs]-41.26875)**2)*41/3
fargcc = np.where((proj<150)&(proj>90)) 

plt.figure(figsize=(19,24),frameon=False)
#CC diagram from SDSS Plot CC of candidates from Subaru and IRAC (or GALEX, SDSS)
ax2=plt.subplot(321)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd-rsd, rsd-isd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#ax2.plot(gnew[uvmtchi[clsuv&starsmall[uvmtchi]]]-inew[uvmtchi[clsuv&starsmall[uvmtchi]]], uvmag[clsuv&starsmall[uvmtchi]], 'r.', alpha=0.4,markersize=2,lw=0, markeredgecolor='none')
#CC of candidates from Subaru red
#ax2.plot(gsd[gcsd&posscand[sdsuba]]-rsd[gcsd&posscand[sdsuba]],rsd[gcsd&posscand[sdsuba]]-isd[gcsd&posscand[sdsuba]], 'r.', alpha=0.4,markersize=4,label='Candidates at Subaru')
#ax2.plot(gsd[gcsd&startf[sdsuba]]-rsd[gcsd&startf[sdsuba]],rsd[gcsd&startf[sdsuba]]-isd[gcsd&startf[sdsuba]], 'y.', alpha=0.45,markersize=3,label='stars')
#CC of candidates from IRAC
#ax2.plot(gsd[gcsd&bigblu[sdsuba]]-rsd[gcsd&bigblu[sdsuba]],rsd[gcsd&bigblu[sdsuba]]-isd[gcsd&bigblu[sdsuba]], 'g.', alpha=1,markersize=4,lw=0, markeredgecolor='none',label='IRAC Candidates')
#ax2.plot(gsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]]-rsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]],rsd[gcsd&posscand[sdsuba]&bigblu[sdsuba]]-isd[gcsd&posscand[sdsuba]&bigblu[sdsuba]], 'g.', alpha=0.8,markersize=5,label='Candidates of Boath Irac and Subaru')
#ax2.plot(gnew[uvmtchi[clsuv&bigblu[sdsuba]]]-inew[uvmtchi[clsuv&bigblu[uvmtchi]]], uvmag[clsuv&bigblu[uvmtchi]], 'g.', alpha=1,markersize=4,lw=0, markeredgecolor='none',label='GALEX Candidates')
#ax2.plot(gsd[gcsd&startf[sdsuba]]-rsd[gcsd&startf[sdsuba]],rsd[gcsd&startf[sdsuba]]-isd[gcsd&startf[sdsuba]], 'y.', alpha=0.45,markersize=3,label='stars')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(r-i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(322)
ax2.plot(usd-rsd, rsd-isd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(usd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')  
ax2.plot(usd[sdssgcs][fargcc]-rsd[sdssgcs][fargcc],rsd[sdssgcs][fargcc]-isd[sdssgcs][fargcc], 'rx', alpha=1,markersize=6,label='Confirmed GCs far') 
ax2.set_xlabel('$(u-r)(SDSS)$')
ax2.set_ylabel('$(r-i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(323)
ax2.plot(gsd-rsd, rsd-zsd, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[sdssgcs][fargcc]-rsd[sdssgcs][fargcc],rsd[sdssgcs][fargcc]-zsd[sdssgcs][fargcc], 'rx', alpha=1,markersize=6,label='Confirmed GCs far')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(r-z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(ccy[0],ccy[-1]+1)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(324)
ax2.plot(usd-rsd, rsd-zsd, 'k.', alpha=0.01,markersize=2,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(usd[gcsd][sdgccan]-rsd[gcsd][sdgccan], rsd[gcsd][sdgccan]-zsd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(usd[sdssgcs]-rsd[sdssgcs],rsd[sdssgcs]-zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(u-r)(SDSS)$')
ax2.set_ylabel('$(r-z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)
ax2.add_patch(PathPatch(pgcsd,facecolor='none',edgecolor='red',lw=1.5))


m31_ra, m31_dec = Angle('00 42 44.3 hours').deg, \
                  Angle('+41 16 9 degrees').deg
dm31 = 777
def ra2kpc(deg):
    ddeg = (deg-m31_ra)*np.cos(np.pi/180.*m31_dec)            
    return ddeg*np.pi/180. * dm31

ax2=plt.subplot(325)
ax2.plot(sdra, sddec, 'k.', alpha=0.1,markersize=1,lw=0, markeredgecolor='none')
#ax2.plot(ggra[wisemtchi[cls]], ggdec[wisemtchi[cls]], 'k.', alpha=0.02,markersize=1)
#ax2.plot(sdra[gcsd][sdgccan], sddec[gcsd][sdgccan], 'g.', alpha=1,markersize=7,label='GC candidates')
#Known GCs
ax2.plot(sdra[sdssgcs],sddec[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('ra')
ax2.set_ylabel('dec')
ax2.invert_xaxis()
#ax2.set_xlim(5.68470833,15.68470833) 
#ax2.set_ylim(46.26875,36.26875)
ax2.legend(loc='lower left', frameon=False)
#print('GC candidate',sdra[gcsd][sdgccan], sddec[gcsd][sdgccan])
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sdra)),ra2kpc(min(sdra)))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)

proj = np.sqrt((sdra[sdssgcs]-10.6847083)**2+(sddec[sdssgcs]-41.26875)**2)*41/3
#print(proj)
fargc = np.where((proj<100)&(proj>90)) 
#print('within 90 and 100 Kpc',sdra[sdssgcs][fargc],sddec[sdssgcs][fargc])
L = sdra[sdssgcs]
R= sddec[sdssgcs]
for nl, nr in zip(L,R):
     print(nl,nr)


ax2=plt.subplot(326)
ax2.plot(gsd-rsd, isd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],isd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], isd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(i)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

plt.figure(figsize=(19,24),frameon=False)
ax2=plt.subplot(321)
ax2.plot(gsd-rsd, usd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],usd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], usd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(u)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(322)
ax2.plot(gsd-rsd, zsd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],zsd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], zsd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(z)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(323)
ax2.plot(gsd-rsd, usd, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
#Known GCs
ax2.plot(gsd[sdssgcs]-rsd[sdssgcs],usd[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(gsd[gcsd][sdgccan]-rsd[gcsd][sdgccan], usd[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.set_xlabel('$(g-r)(SDSS)$')
ax2.set_ylabel('$(u)(SDSS)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

print('known GCs captured',len(zsd[sdssgcs])) 

plt.figure(figsize=(10,10),frameon=False)
#CC diagram from SDSS Plot CC of candidates from Subaru and IRAC (or GALEX, SDSS)
ax2=plt.subplot(221)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radg, 'k.', alpha=0.01,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[gcsd][sdgccan], radg[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(gsd[sdssgcs],radg[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('g  radius$(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(222)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radu, 'k.', alpha=0.02,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[gcsd][sdgccan], radu[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(gsd[sdssgcs],radu[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('u  radius$(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

ax2=plt.subplot(223)
#SDSS color of gr vs ri CC diagram of data that matches with Subaru black
ax2.plot(gsd, radz, 'k.', alpha=0.02,markersize=1,lw=0, markeredgecolor='none')
ax2.plot(gsd[gcsd][sdgccan], radz[gcsd][sdgccan], 'g.', alpha=0.4,markersize=3,label='GC candidates')
ax2.plot(gsd[sdssgcs],radz[sdssgcs], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.set_xlabel('$(g)(SDSS)$')
ax2.set_ylabel('z  radius$(SDSS)$')
ax2.set_ylim(0,10)
#ax2.set_ylim(ccy[0],ccy[-1])
#cx[0],ccx[-1],ccy[-1],ccy[0]
ax2.legend(loc='lower left', frameon=False)

"""#SDSS WISE All cluster"""

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/irac/irac_M31clusterall.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31SDSSdr16cluster2_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss31['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss31['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss31['i'] = sdss31['i'].ravel()
isd = sdss31['i']

x=(np.log(10)/(-2.5))*sdss31['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss31['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss31['g'] = sdss31['g'].ravel()
gsd = sdss31['g']

x=(np.log(10)/(-2.5))*sdss31['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss31['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss31['r'] = sdss31['r'].ravel()
rsd = sdss31['r']

x=(np.log(10)/(-2.5))*sdss31['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss31['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss31['u'] = sdss31['u'].ravel()
usd = sdss31['u']

x=(np.log(10)/(-2.5))*sdss31['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss31['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss31['z'] = sdss31['z'].ravel()
zsd = sdss31['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()
radu = sdss31['petroRad_u']
radg = sdss31['petroRad_g']
radr = sdss31['petroRad_r']
radi = sdss31['petroRad_i']
radz = sdss31['petroRad_z']



wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,sdsscd3)
cls = wisemtchdist.arcsec<0.75
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8


wilespec, wilespecdist, _ = match_coordinates_sky(galgccd,sdsscd3) 
# find nearest match
wileclpec =  wilespecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS
wispec, wispecdist, _ = match_coordinates_sky(wisecd,galgccd[wileclpec]) 
# find nearest match
wilpec = wispecdist.arcsec<0.8

xyp = np.empty([len(gsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
gcsd = ((ingcsd==True)&(gsd<20)&(radg<7)&(radg>2.5)&(usd<21)&(radu>2.5)&(radu<7)
&(radz>2.5)&(radz<7)&(usd-rsd<2.5)&(gsd-rsd<1)&(gsd-rsd>-0.2)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)

xyj = np.empty([len(wise2[cls&gcsd[wisemtchi]]),2]) 
xyj[:,1] = rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]]
xyj[:,0] = gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]]

pgcwi = Path([(0.5,2),(0.76,2.84),
          (0.86,2.44),(0.5,1.6),(0.5,2)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = (ingcwi==True)
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])

plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-[4.6])$')
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise4[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[22])$')
ax2.set_xlim(0,7)
ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[4.6])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets ')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-10.6847083)**2+(sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-41.26875)**2)*41/3
fargc = np.where((proj>150)&(isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]<18))
ax2=plt.subplot(236)
ax2.plot(sra[wisemtchi[cls]], sdec[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1)
#ax2.plot(sra[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gdec[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], 'r.', alpha=0.5,markersize=4,label='GC candidates')
ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'r.', alpha=1,markersize=7,label='GC candidates')
ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], 'g.', alpha=1,markersize=9,label='GC candidates (>150 Kpc)')
#Confirmed GCs
ax2.plot(sra[wisemtchi[clpec]], sdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(-2,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], isd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(usd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-zsd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(usd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]- zsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-r)$')
ax2.set_ylabel('$(r-z)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-10.6847083)**2+(sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-41.26875)**2)*41/3
projcon = np.sqrt((sra[wisemtchi[clpec]]-10.6847083)**2+(sra[wisemtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)
fargc = np.where((proj>150)&(isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]<18))
L =  sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc]
R =  sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc]
for lval,rval in zip(L,R):
     print(lval,rval)

"""#GALEX and SDSS M31 all
M31 GC candidate #4
"""

fnew = fits.open('/gdrive/My Drive/Astro Research/M31/GALEX/M31GALEXLallcluster2_jiamingp.fit')
galex = fnew[1].data
galexcd = SkyCoord(ra=galex['ra'][:],
                      dec=galex['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fnew.close()
galexcd = galexcd.ravel()

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31SDSSdr16cluster2_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss31['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss31['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss31['i'] = sdss31['i'].ravel()
isd = sdss31['i']

x=(np.log(10)/(-2.5))*sdss31['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss31['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss31['g'] = sdss31['g'].ravel()
gsd = sdss31['g']

x=(np.log(10)/(-2.5))*sdss31['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss31['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss31['r'] = sdss31['r'].ravel()
rsd = sdss31['r']

x=(np.log(10)/(-2.5))*sdss31['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss31['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss31['u'] = sdss31['u'].ravel()
usd = sdss31['u']

x=(np.log(10)/(-2.5))*sdss31['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss31['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss31['z'] = sdss31['z'].ravel()
zsd = sdss31['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()
radu = sdss31['petroRad_u']
radg = sdss31['petroRad_g']
radr = sdss31['petroRad_r']
radi = sdss31['petroRad_i']
radz = sdss31['petroRad_z']


#Match with SDSS
uvmtchi, uvmtchdist, _ = match_coordinates_sky(galexcd,sdsscd3)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(galexcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
uvmag = galex['survey']
uvmag  = uvmag.ravel()

#co = uvmag[clsuv&posscand[uvmtchi]]-gnew[uvmtchi[clsuv&posscand[uvmtchi]]]
#galecand = np.where((co>2.9)&((co>4)|(co<3.3)))
print('identified GCs',len(galpec[clpec]))

#Extinction correction
scoordsd = SkyCoord(ra=sra, dec=sdec,
                         unit=(u.deg, u.deg), frame='icrs')

# SFD correction of magnitudes
sfd  = SFD(path=googlepath+"SFD/")
sgal_coords = scoordsd.galactic
x,y = sfd.wcs_south.wcs_world2pix(sgal_coords.l.deg, sgal_coords.b.deg, 0) #south
ok_coords, = np.where(x > 0)
EBV = np.zeros(len(scoordsd))
EBV[ok_coords] = sfd.sfd_north[x[ok_coords].astype(int),
                               y[ok_coords].astype(int)]

A_g = 3.303*EBV
A_r = 2.285*EBV
A_i = 1.698*EBV
A_u = 4.239*EBV
A_z = 1.263*EBV

gsd = np.hstack(gsd)-A_g
rsd = np.hstack(rsd)-A_r
isd = np.hstack(isd)-A_i
usd = np.hstack(usd)-A_u
zsd = np.hstack(zsd)-A_z

xyp = np.empty([len(gsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd

pgcsd = Path([(1.7-0.5,0.45-0.25),(2.57-0.7,0.75-0.3),
          (2.67-0.7,0.65-0.3),(2.2-0.7,0.42-0.3),
          (1.8-0.5,0.45-0.25),(1.7-0.5,0.45-0.25)])
ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
#gcsd = ((ingcsd==True)&(gsd<22)&(radg<7)&(radg>2)&(usd<22)&(radu>2)&(radu<7)
#&(radz>2)&(radz<7)&(gsd-rsd<1)&(gsd-rsd>0)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)
gcsd = ((ingcsd==True)&(gsd<22)&(usd<22)&(radz>2)&(radz<7))
#xyj = np.empty([len(uvmag[cls&gcsd[wisemtchi]]),2]) 
#xyj[:,1] = rsd[uvmtchdist[clsuv&gcsd[uvmtchdist]]]-wise2[cls&gcsd[wisemtchi]]
#xyj[:,0] = gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]]

#pgcwi = Path([(0.5,2),(0.76,2.84),
#          (0.86,2.44),(0.5,1.6),(0.5,2)])
#ingcwi = pgcwi.contains_points(xyj) 
#gcwi = (ingcwi==True)
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])

#GC candidate based on Galex color
A = usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]]
B = uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]]
gacan = np.where((uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]]>3.1)&(B>1.58*A-1.18)&(B<1.2*A+2.2))

#M31 candidate sra[wisemtchi[wilpec]][gcwiga][clog] 
m31can = ((sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]<21.25673)&(sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]>21.25671)
&(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]<46.00700)&(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]>46.00500))


plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(rsd[uvmtchi[clsuv]]-isd[uvmtchi[clsuv]], uvmag[clsuv]-gsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=0.2,markersize=5,label='GC Candidaets')
ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can], uvmag[clsuv&gcsd[uvmtchi]][gacan][m31can]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can], 'rv', alpha=1,markersize=8,label='GC Candidaets #4')
ax2.plot(rsd[uvmtchi[clpec]]-isd[uvmtchi[clpec]], uvmag[clpec]-gsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(r-i)$')
ax2.set_ylabel('$([nuv]-g)$')
ax2.set_xlim(-2,2)
ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)
#ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(232)
ax2.plot(usd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], uvmag[clsuv]-gsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=0.2,markersize=5,label='GC Candidaets')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can], uvmag[clsuv&gcsd[uvmtchi]][gacan][m31can]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can], 'rv', alpha=1,markersize=8,label='GC Candidaets #4')
ax2.plot(usd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], uvmag[clpec]-gsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$([nuv]-g)$')
ax2.set_xlim(-2,7)
ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(233)
ax2.plot(usd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], uvmag[clsuv], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(usd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], uvmag[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan], 'rx', alpha=0.2,markersize=5,label='GC Candidaets')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can], uvmag[clsuv&gcsd[uvmtchi]][gacan][m31can], 'rv', alpha=1,markersize=8,label='GC Candidaets #4')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$([nuv])$')
ax2.set_xlim(-2,7)
ax2.set_ylim(27,17)
ax2.legend(loc='upper left', frameon=False)
print('identified GCs',len(uvmag[clpec]))

ax2=plt.subplot(234)
ax2.plot(sra[uvmtchi[clsuv]], sdec[uvmtchi[clsuv]], 'k.', alpha=0.07,markersize=1)
#ax2.plot(sra[uvmtchi[clpec]], gdec[uvmtchi[clpec]], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]], 'r.', alpha=0.1,markersize=3,label='GC candidates from SDSS')
ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'r.', alpha=0.2,markersize=4,label='GC candidates')
ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][m31can], 'rv', alpha=1,markersize=9,label='GC Candidaets #4')
#Confirmed GCs
ax2.plot(sra[uvmtchi[clpec]], sdec[uvmtchi[clpec]], 'bx', alpha=1,markersize=7,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(5,15) 
#ax2.set_ylim(35,47)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(gsd[uvmtchi[clsuv]]-rsd[uvmtchi[clsuv]], isd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], isd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(usd[uvmtchi[clsuv]]-rsd[uvmtchi[clsuv]], rsd[uvmtchi[clsuv]]-zsd[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(usd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], rsd[uvmtchi[clpec]]-zsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
ax2.plot(usd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-zsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=0.2,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-r)$')
ax2.set_ylabel('$(r-z)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-10.6847083)**2+(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-41.26875)**2)*41/3
projcon = np.sqrt((sra[uvmtchi[clpec]]-10.6847083)**2+(sdec[uvmtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=0.2,markersize=4 ,label='GC Candidates')
plt.plot(projcon, isd[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)

#Position
ralfcf = sra[uvmtchi[clpec]]
declfcf = sdec[uvmtchi[clpec]]
ralfall = sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
declfall= sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
projlf = np.sqrt((sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-10.6847083)**2+(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-41.26875)**2)*41/3
projconlf = np.sqrt((sra[uvmtchi[clpec]]-10.6847083)**2+(sdec[uvmtchi[clpec]]-41.26875)**2)*41/3
ilf = isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
ilfcf = isd[uvmtchi[clpec]]
grlf = gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
grlfcf = gsd[uvmtchi[clpec]]-rsd[uvmtchi[clpec]]
rilf = rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]
rilfcf = rsd[uvmtchi[clpec]]-isd[uvmtchi[clpec]]

clo = np.where(proj>150)
up33 = np.where(sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][clo]>40)
Lc = sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][clo][up33]
Rc = sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan][clo][up33]
print('GC candidates in both SDSS and GALEX (>150 Kpc)')
for nr, nl in zip(Lc,Rc):
     print(nr,nl)

"""#GALEX WISE All M31"""

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/irac/irac_M31clusterall.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']

#SDSS
fs = fits.open('/gdrive/My Drive/Astro Research/M31/M31SDSSdr16cluster2_jiamingp.fit')
sdss31 = fs[1].data
sdsscd3 = SkyCoord(ra=sdss31['ra'][:],
                      dec=sdss31['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
sdsscd3=sdsscd3.ravel()
x=(np.log(10)/(-2.5))*sdss31['i']-np.log(1.8e-10)
ii=(np.exp(x)-np.exp(-x))/2
sdss31['i']=-2.5*np.log10(2*1.8e-10*ii)#*24.36	
sdss31['i'] = sdss31['i'].ravel()
isd = sdss31['i']

x=(np.log(10)/(-2.5))*sdss31['g']-np.log(0.9e-10)
gg=(np.exp(x)-np.exp(-x))/2
sdss31['g']=-2.5*np.log10(2*0.9e-10*gg)#*25.11		
sdss31['g'] = sdss31['g'].ravel()
gsd = sdss31['g']

x=(np.log(10)/(-2.5))*sdss31['r']-np.log(1.2e-10)
rr=(np.exp(x)-np.exp(-x))/2
sdss31['r']=-2.5*np.log10(2*1.2e-10*rr)#*24.80	
sdss31['r'] = sdss31['r'].ravel()
rsd = sdss31['r']

x=(np.log(10)/(-2.5))*sdss31['u']-np.log(1.4e-10)
uu=(np.exp(x)-np.exp(-x))/2
sdss31['u']=-2.5*np.log10(2*1.4e-10*uu)#*24.63	
sdss31['u'] = sdss31['u'].ravel()
usd = sdss31['u']

x=(np.log(10)/(-2.5))*sdss31['z']-np.log(7.4e-10)
zz=(np.exp(x)-np.exp(-x))/2
sdss31['z']=-2.5*np.log10(2*7.4e-10*zz)#*22.83	
sdss31['z'] = sdss31['z'].ravel()
zsd = sdss31['z']

sra = sdss31['ra'][:].ravel()
sdec = sdss31['dec'][:].ravel()
radu = sdss31['petroRad_u']
radg = sdss31['petroRad_g']
radr = sdss31['petroRad_r']
radi = sdss31['petroRad_i']
radz = sdss31['petroRad_z']



wisemtchi, wisemtchdist, _ = match_coordinates_sky(wisecd,sdsscd3)
cls = wisemtchdist.arcsec<0.75
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,sdsscd3) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<0.8

L = ralfall
#print(L)
R = declfall
for lval,rval in zip(L,R):
   #  print(lval,rval)
     galgccd = SkyCoord(ra=L,dec=R,unit=(u.deg, u.deg))

wilespec, wilespecdist, _ = match_coordinates_sky(galgccd,sdsscd3) 
# find nearest match
wileclpec =  wilespecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(wisecd,galgccd[wileclpec]) 
# find nearest match
wilpec = wispecdist.arcsec<0.8

xyp = np.empty([len(gsd),2]) 
xyp[:,0] = usd-rsd
xyp[:,1] = rsd-zsd

pgcsd = Path([(1.7,0.45),(2.57,0.75),
          (2.67,0.65),(2.2,0.42),
          (1.8,0.3),(1.7,0.45)])
ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
gcsd = ((ingcsd==True)&(gsd<20)&(radg<7)&(radg>2.5)&(usd<21)&(radu>2.5)&(radu<7)
&(radz>2.5)&(radz<7)&(usd-rsd<2.5)&(gsd-rsd<1)&(gsd-rsd>0.2)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)
galsd = ((ingcsd==True))
xyj = np.empty([len(wise2[cls&gcsd[wisemtchi]]),2]) 
xyj[:,1] = rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]]
xyj[:,0] = gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]]

pgcwi = Path([(0.5,2),(0.76,2.84),
          (0.86,2.44),(0.5,1.6),(0.5,2)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = (ingcwi==True)
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])
xyj = np.empty([len(gsd[wisemtchi[wilpec]]),2]) 
xyj[:,1] = rsd[wisemtchi[wilpec]]-wise2[wilpec]
xyj[:,0] = gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]]

pgcwii = Path([(0.5,2),(0.76,2.84),
          (0.86,2.44),(0.5,1.6),(0.5,2)])
ingcwii = pgcwii.contains_points(xyj) 
gcwiga = (ingcwii==True)

projgal = np.sqrt((sra[wisemtchi[wilpec]][gcwiga]-10.6847083)**2+(sdec[wisemtchi[wilpec]][gcwiga]-41.26875)**2)*41/3
farg = np.where(projgal>150)
clog = np.where(projgal<150)
cm33 = np.where(sra[wisemtchi[wilpec]][gcwiga][farg]>10)

#M31 candidate sra[wisemtchi[wilpec]][gcwiga][clog] 
m31can = ((sra[wisemtchi[wilpec]]<21.25673)&(sra[wisemtchi[wilpec]]>21.25671)
&(sdec[wisemtchi[wilpec]]<46.00700)&(sdec[wisemtchi[wilpec]]>46.00500))

plt.figure(figsize=(18*1.8,9*1.8),frameon=False)  
ax2=plt.subplot(231)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.02,markersize=1, label='match with WISE')
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
ax2.plot(gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], rsd[wisemtchi[wilpec]]-wise2[wilpec], 'rx', alpha=0.2,markersize=4,label='GALEX GC candidates')
ax2.plot(gsd[wisemtchi[wilpec]][m31can]-rsd[wisemtchi[wilpec]][m31can], rsd[wisemtchi[wilpec]][m31can]-wise2[wilpec][m31can], 'rv', alpha=1,markersize=8,label='GC candidates #4')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-[4.6])$')
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise4[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise4[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise4[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-isd[wisemtchi[wilpec]], isd[wisemtchi[wilpec]]-wise4[wilpec], 'rx', alpha=0.2,markersize=4,label='GALEX GC candidates')
ax2.plot(usd[wisemtchi[wilpec]][m31can]-isd[wisemtchi[wilpec]][m31can], isd[wisemtchi[wilpec]][m31can]-wise4[wilpec][m31can], 'rv', alpha=1,markersize=8,label='GC candidates #4')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[22])$')
ax2.set_xlim(0,7)
ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(usd[wisemtchi[cls]]-isd[wisemtchi[cls]], isd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-isd[wisemtchi[clpec]], isd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-isd[wisemtchi[wilpec]], isd[wisemtchi[wilpec]]-wise1[wilpec], 'rx', alpha=0.2,markersize=4,label='GALEX GC candidates')
ax2.plot(usd[wisemtchi[wilpec]][m31can]-isd[wisemtchi[wilpec]][m31can], isd[wisemtchi[wilpec]][m31can]-wise1[wilpec][m31can], 'rv', alpha=1,markersize=8,label='GC candidates #4')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-i)$')
ax2.set_ylabel('$(i-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-zsd[wisemtchi[wilpec]], zsd[wisemtchi[wilpec]]-wise2[wilpec], 'rx', alpha=0.2,markersize=4,label='GALEX GC candidates')
ax2.plot(usd[wisemtchi[wilpec]][gcwiga]-zsd[wisemtchi[wilpec]][gcwiga], zsd[wisemtchi[wilpec]][gcwiga]-wise2[wilpec][gcwiga], 'gx', alpha=0.2,markersize=4,label='GALEX GC candidates WISE')
ax2.plot(usd[wisemtchi[wilpec]][m31can]-zsd[wisemtchi[wilpec]][m31can], zsd[wisemtchi[wilpec]][m31can]-wise2[wilpec][m31can], 'rv', alpha=1,markersize=8,label='GC candidates #4')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[4.6])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(usd[wisemtchi[cls]]-zsd[wisemtchi[cls]], zsd[wisemtchi[cls]]-wise1[cls], 'k.', alpha=0.05,markersize=1)
ax2.plot(usd[wisemtchi[clpec]]-zsd[wisemtchi[clpec]], zsd[wisemtchi[clpec]]-wise1[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-zsd[wisemtchi[wilpec]], zsd[wisemtchi[wilpec]]-wise1[wilpec], 'rx', alpha=0.2,markersize=4,label='GALEX GC candidates')
ax2.plot(usd[wisemtchi[wilpec]][m31can]-zsd[wisemtchi[wilpec]][m31can], zsd[wisemtchi[wilpec]][m31can]-wise1[wilpec][m31can], 'rv', alpha=1,markersize=8,label='GC candidates #4')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets ')
ax2.set_xlabel('$(u-z)$')
ax2.set_ylabel('$(z-[3.4])$')
ax2.set_xlim(1,7)
ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)
projgal = np.sqrt((sra[wisemtchi[wilpec]][gcwiga]-10.6847083)**2+(sdec[wisemtchi[wilpec]][gcwiga]-41.26875)**2)*41/3
farg = np.where(projgal>150)
ax2=plt.subplot(236)
ax2.plot(sra[wisemtchi[cls]], sdec[wisemtchi[cls]], 'k.', alpha=0.01,markersize=1)
#ax2.plot(sra[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gdec[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'r.', alpha=1,markersize=7,label='GC candidates')
#Confirmed GCs
ax2.plot(sra[wisemtchi[clpec]], sdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
ax2.plot(sra[wisemtchi[wilpec]][gcwiga], sdec[wisemtchi[wilpec]][gcwiga], 'gx', alpha=1,markersize=5,label='Confirmed GCs WISE GALEX')
ax2.plot(sra[wisemtchi[wilpec]][gcwiga][farg], sdec[wisemtchi[wilpec]][gcwiga][farg], 'rx', alpha=1,markersize=7,label='Confirmed GCs WISE GALEX')
ax2.plot(sra[wisemtchi[wilpec]][m31can], sdec[wisemtchi[wilpec]][m31can], 'rv', alpha=1,markersize=8,label='GC candidates #4')
#ax2.plot(sra[wisemtchi[wilpec]], sdec[wisemtchi[wilpec]], 'rx', alpha=1,markersize=4,label='GALEX GC candidates') 
ax2.plot(23.4621000  ,  30.6599417 , 'kx', alpha=1,markersize=14,label='M31 ') 
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(-2,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)
#print('confirmed GCs',sra[wisemtchi[clpec]], sdec[wisemtchi[clpec]])
print('GC candidates in both GALEX and WISE',sra[wisemtchi[wilpec]][gcwiga], sdec[wisemtchi[wilpec]][gcwiga])
print('GC candidates in both GALEX and WISE',sra[wisemtchi[wilpec]][gcwiga], sdec[wisemtchi[wilpec]][gcwiga])
projgal = np.sqrt((sra[wisemtchi[wilpec]][gcwiga]-10.6847083)**2+(sdec[wisemtchi[wilpec]][gcwiga]-41.26875)**2)*41/3
farg = np.where(projgal>150)
clog = np.where(projgal<150)
cm33 = np.where(sra[wisemtchi[wilpec]][gcwiga][farg]>10)
Lc = sra[wisemtchi[wilpec]][gcwiga][clog]
Rc = sdec[wisemtchi[wilpec]][gcwiga][clog]
print('GC candidates in both GALEX and WISE (>150 Kpc) closer to M33')
for nr, nl in zip(Lc,Rc):
     print(nr,nl)
L = sra[wisemtchi[wilpec]][gcwiga][farg][cm33]
R = sdec[wisemtchi[wilpec]][gcwiga][farg][cm33]
for nr, nl in zip(L,R):
     print('GC candidates in both GALEX and WISE (>150 Kpc) closer to M33',nr,nl)

nocm33 = np.where(sra[wisemtchi[wilpec]][gcwiga][farg]<10)
Lr = sra[wisemtchi[wilpec]][gcwiga][farg][nocm33]
Rr = sdec[wisemtchi[wilpec]][gcwiga][farg][nocm33]
for nr, nl in zip(Lr,Rr):
     print('GC candidates in both GALEX and WISE (>150 Kpc) no closer to M33',nr,nl)

nocm33 = np.where(sra[wisemtchi[wilpec]][gcwiga][farg]<10)
lowerc = np.where(rsd[wisemtchi[wilpec]]-wise2[wilpec]<2)
projgall = np.sqrt((sra[wisemtchi[wilpec]][lowerc]-10.6847083)**2+(sdec[wisemtchi[wilpec]][lowerc]-41.26875)**2)*41/3
fargg = np.where((projgall<150)&(projgall>130))
Lrd = sra[wisemtchi[wilpec]][lowerc][fargg]
Rrd = sdec[wisemtchi[wilpec]][lowerc][fargg]
for nr, nl in zip(Lrd,Rrd):
     print('GC candidates in both GALEX and WISE (>150 Kpc) downward color',nr,nl)
gawigcra = sra[wisemtchi[wilpec]][gcwiga]
ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.figure(figsize=(8,8),frameon=False)  
ax2=plt.subplot(111)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], wise1[cls]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], wise1[clpec]-wise2[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], wise1[wilpec]-wise2[wilpec], 'rx', alpha=1,markersize=4,label='GALEX GC candidates')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=1,markersize=5,label='GC Candidaets from SDSS')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$([3.4]-[4.6])$')
#ax2.set_xlim(-0.5,2.5)
#ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(gsd[wisemtchi[cls]]-rsd[wisemtchi[cls]], isd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], isd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=5,label='GC Candidaets GALEX')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(usd[wisemtchi[cls]]-rsd[wisemtchi[cls]], rsd[wisemtchi[cls]]-zsd[wisemtchi[cls]], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(usd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], rsd[wisemtchi[clpec]]- zsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
ax2.plot(usd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], rsd[wisemtchi[wilpec]]-zsd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=5,label='GC Candidaets GALEX')
ax2.set_xlabel('$(u-r)$')
ax2.set_ylabel('$(r-z)$')
ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((sra[wisemtchi[wilpec]]-10.6847083)**2+(sdec[wisemtchi[wilpec]]-41.26875)**2)*41/3
projgal = np.sqrt((sra[wisemtchi[wilpec]][gcwiga]-10.6847083)**2+(sdec[wisemtchi[wilpec]][gcwiga]-41.26875)**2)*41/3
projcon = np.sqrt((sra[wisemtchi[clpec]]-10.6847083)**2+(sra[wisemtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,isd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=4 ,label='GC Candidates') 
plt.plot(projgal,isd[wisemtchi[wilpec]][gcwiga], 'gx', alpha=1,markersize=7 ,label='GC Candidates selected by IRAC')
plt.plot(projcon, isd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
#ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, rsd[wisemtchi[wilpec]]-wise2[wilpec], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projgal,rsd[wisemtchi[wilpec]][gcwiga]-wise2[wilpec][gcwiga], 'gx', alpha=1,markersize=7 ,label='GC Candidates selected by IRAC')
plt.plot(projcon,rsd[wisemtchi[clpec]]-wise2[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$r-[4.6]$',fontsize=15)


ax2=plt.subplot(233)
#ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, gsd[wisemtchi[wilpec]]-rsd[wisemtchi[wilpec]], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projgal,gsd[wisemtchi[wilpec]][gcwiga]-rsd[wisemtchi[wilpec]][gcwiga], 'gx', alpha=1,markersize=7 ,label='GC Candidates selected by IRAC')
plt.plot(projcon,gsd[wisemtchi[clpec]]-rsd[wisemtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)

print(np.sqrt((12.676919439117796-10.6847083)**2+(32.916312515946125-41.26875)**2)*41/3)

proj = np.sqrt((21.256725079734395-10.6847083)**2+(46.006004644657715-41.26875)**2)*41/3
print(proj)

"""#WISE and GALEX
not used to select candidates
"""

import pandas as pd 
wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/irac/irac_M31clusterall.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']



fnew = fits.open('/gdrive/My Drive/Astro Research/M31/GALEX/M31GALEXLallcluster2_jiamingp.fit')
galex = fnew[1].data
galexcd = SkyCoord(ra=galex['ra'][:],
                      dec=galex['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fnew.close()
galexcd = galexcd.ravel()

#Match with WISE
uvmtchi, uvmtchdist, _ = match_coordinates_sky(galexcd,wisecd)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,wisecd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(galexcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
uvmag = galex['survey']
uvmag  = uvmag.ravel()

print('identified GCs',len(galpec[clpec]))

wra = wise['ra']
wdec = wise['dec']

gcwige = ((wise1[uvmtchi[clsuv]]-wise3[uvmtchi[clsuv]]>1)&(wise1[uvmtchi[clsuv]]-wise3[uvmtchi[clsuv]]<3)&(uvmag[clsuv]<22)&( uvmag[clsuv]>20.5))
plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(uvmag[clsuv]-wise2[uvmtchi[clsuv]], uvmag[clsuv]-wise3[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
#ax2.plot(wise1[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(uvmag[clpec]-wise2[uvmtchi[clpec]], uvmag[clpec]-wise3[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$([3.4]-[4.6])$')
ax2.set_ylabel('$([nuv]-[3.4])$')
#ax2.set_xlim(-2,2)
#ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)
#ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(232)
ax2.plot(wise1[uvmtchi[clsuv]]-wise3[uvmtchi[clsuv]], uvmag[clsuv]-wise4[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
#ax2.plot(wise1[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(wise1[uvmtchi[clpec]]-wise3[uvmtchi[clpec]], uvmag[clpec]-wise4[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$([3.4]-[4.6])$')
ax2.set_ylabel('$([nuv]-[3.4])$')
#ax2.set_xlim(-2,2)
#ax2.set_ylim(-2.5,12)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(233)
ax2.plot(wise1[uvmtchi[clsuv]]-wise3[uvmtchi[clsuv]], uvmag[clsuv], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(rsd[uvmtchi[clsuv&gcsd[uvmtchi]]]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]], uvmag[clsuv&gcsd[uvmtchi]]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]], 'rx', alpha=0.2,markersize=5,label='GC Candidaets from SDSS')
#ax2.plot(wise1[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], uvmag[clsuv&gcsd[uvmtchi]][gacan]-gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(wise1[uvmtchi[clpec]]-wise3[uvmtchi[clpec]], uvmag[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.set_xlabel('$([3.4]-[4.6])$')
ax2.set_xlabel('$(w1-w2)$')
ax2.set_ylabel('$([nuv])$')
ax2.set_xlim(-2,7)
ax2.set_ylim(27,17)
ax2.legend(loc='upper left', frameon=False)
print('identified GCs',len(uvmag[clpec]))

ax2=plt.subplot(234)
ax2.plot(wra[uvmtchi[clsuv]], wdec[uvmtchi[clsuv]], 'k.', alpha=0.07,markersize=1)
ax2.plot(wra[uvmtchi[clsuv]][gcwige], wdec[uvmtchi[clsuv]][gcwige], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]], 'r.', alpha=0.1,markersize=3,label='GC candidates from SDSS')
#ax2.plot(sra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], sdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'r.', alpha=1,markersize=7,label='GC candidates')
#Confirmed GCs
ax2.plot(wra[uvmtchi[clpec]], wdec[uvmtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(5,15) 
#ax2.set_ylim(35,47)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

#ax22 = ax2.twiny()
#ax22.set_xlim(ra2kpc(max(sra[wisemtchi[cls]])),ra2kpc(min(sra[wisemtchi[cls]])))
#ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
#ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

#proj = np.sqrt((wra[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-10.6847083)**2+(wdec[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-41.26875)**2)*41/3
projcon = np.sqrt((wra[uvmtchi[clpec]]-10.6847083)**2+(wdec[uvmtchi[clpec]]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
#plt.plot(proj,isd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, wise1[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$W1$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
#ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
#plt.plot(proj, gsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan]-rsd[uvmtchi[clsuv&gcsd[uvmtchi]]][gacan], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,wise1[uvmtchi[clpec]]-wise4[uvmtchi[clpec]], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$W1-W4$',fontsize=15)

#L =  wra[uvmtchi[clsuv]][gcwige]
#R =  wdec[uvmtchi[clsuv]][gcwige]
#for lval,rval in zip(L,R):
#     print(lval,rval)

"""#Pan-Star M31 upper """

#Confirmed GCs of Panstar M31 upper region

#fits.info('/gdrive/My Drive/Astro Research/M31/Pan-star/M31Panstallcluster3_JiamingP.fit')
import pandas as pd 
fs = fits.open('/gdrive/My Drive/Astro Research/M31/Pan-star/M31Panstallcluster3_JiamingP.fit')
pstar = fs[1].data
pstarcd = SkyCoord(ra=pstar['raMean'][:],
                      dec=pstar['decMean'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
pstarcd = pstarcd.ravel()
pg = pstar['gMeanPSFMag'].ravel()
pi = pstar['iMeanPSFMag'].ravel()
pr = pstar['rMeanPSFMag'].ravel()
pz = pstar['zMeanPSFMag'].ravel()

pra = pstar['raMean'].ravel()
pdec = pstar['decMean'].ravel()

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/irac/irac_M31clusterall.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']


uvmtchi, uvmtchdist, _ = match_coordinates_sky(pstarcd,wisecd)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,wisecd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(pstarcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
print('identified GCs',len(galpec[clpec]))

pg = pstar['gMeanPSFMag'].ravel()
pi = pstar['iMeanPSFMag'].ravel()
pr = pstar['rMeanPSFMag'].ravel()
pz = pstar['zMeanPSFMag'].ravel()

pra = pstar['raMean'].ravel()
pdec = pstar['decMean'].ravel()

#Extinction correction
scoordpd = SkyCoord(ra=pra, dec=pdec,
                         unit=(u.deg, u.deg), frame='icrs')

# SFD correction of magnitudes
sfd  = SFD(path=googlepath+"SFD/")
sgal_coords = scoordpd.galactic
x,y = sfd.wcs_south.wcs_world2pix(sgal_coords.l.deg, sgal_coords.b.deg, 0) #south
ok_coords, = np.where(x > 0)
EBV = np.zeros(len(scoordpd))
EBV[ok_coords] = sfd.sfd_north[x[ok_coords].astype(int),
                               y[ok_coords].astype(int)]

A_g = 3.172*EBV
A_r = 2.271*EBV
A_i = 1.682*EBV
A_z = 1.322*EBV

pg = np.hstack(pg)-A_g
pr = np.hstack(pr)-A_r
pi = np.hstack(pi)-A_i
pz = np.hstack(pz)-A_z

#xyp = np.empty([len(gsd),2]) 
#xyp[:,0] = usd-rsd
#xyp[:,1] = rsd-zsd

#pgcsd = Path([(1.7,0.45),(2.57,0.75),
#          (2.67,0.65),(2.2,0.42),
#          (1.8,0.3),(1.7,0.45)])
#ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
#gcsd = ((ingcsd==True)&(gsd<20)&(radg<7)&(radg>2.5)&(usd<21)&(radu>2.5)&(radu<7)
#&(radz>2.5)&(radz<7)&(usd-rsd<2.5)&(gsd-rsd<1)&(gsd-rsd>-0.2)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)

xyj = np.empty([len(wise2[uvmtchi[clsuv]]),2]) 
xyj[:,1] = pr[clsuv]-wise2[uvmtchi[clsuv]]
xyj[:,0] =pg[clsuv]-pr[clsuv]

pgcwi = Path([(0.42,2.7),(0.65,2.89),
                        (0.7,3.4),(0.4,3.4),(0.42,2.7)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = (ingcwi==True)

#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])

#gccand = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>2.5)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<3.5))
#redder confirmed GCs
reccan = (pr[clpec]-wise2[uvmtchi[clpec]]>4)
stacan = (pz[clpec]-pr[clpec]>-0.2)
plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise2[uvmtchi[clsuv]], 'k.', alpha=0.5,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise2[uvmtchi[clpec]], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(pg[clpec][reccan]-pr[clpec][reccan], pr[clpec][reccan]-wise2[uvmtchi[clpec]][reccan], 'bx', alpha=1,markersize=8)
ax2.plot(pg[clpec][stacan]-pr[clpec][stacan], pr[clpec][stacan]-wise2[uvmtchi[clpec]][stacan], 'rx', alpha=1,markersize=8,label='Potential Star')
#ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise2[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-[4.6])$')
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
#ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(pz[clsuv]-pr[clsuv], pg[clsuv]-pr[clsuv], 'k.', alpha=0.1,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pz[clsuv][gcwi]-pr[clsuv][gcwi], pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pz[clpec]-pr[clpec], pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(pz[clpec][reccan]-pr[clpec][reccan], pg[clpec][reccan]-pr[clpec][reccan], 'bx', alpha=1,markersize=8)
ax2.plot(pz[clpec][stacan]-pr[clpec][stacan], pg[clpec][stacan]-pr[clpec][stacan], 'rx', alpha=1,markersize=8)
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(z-r)$')
ax2.set_ylabel('$(g-r)$')
ax2.set_xlim(-2,1)
#ax2.set_xlim(0,7)
#ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise1[uvmtchi[clsuv]], 'k.', alpha=0.5,markersize=1, label='match with WISE')
#ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise1[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise1[uvmtchi[clpec]], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(pg[clpec][reccan]-pr[clpec][reccan], pr[clpec][reccan]-wise1[uvmtchi[clpec]][reccan], 'bx', alpha=1,markersize=8)
ax2.plot(pg[clpec][stacan]-pr[clpec][stacan], pr[clpec][stacan]-wise1[uvmtchi[clpec]][stacan], 'rx', alpha=1,markersize=8)
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-[3.4])$')
#ax2.set_xlim(-2,1)
#ax2.set_xlim(-0.5,2.5)
#ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise3[uvmtchi[clsuv]], 'k.', alpha=0.1,markersize=1, label='match with WISE')
#ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise3[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise3[uvmtchi[clpec]], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(pg[clpec][reccan]-pr[clpec][reccan], pr[clpec][reccan]-wise3[uvmtchi[clpec]][reccan], 'bx', alpha=1,markersize=8)
ax2.plot(pg[clpec][stacan]-pr[clpec][stacan], pr[clpec][stacan]-wise3[uvmtchi[clpec]][stacan], 'rx', alpha=1,markersize=8)
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-w3)$')
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise4[uvmtchi[clsuv]], 'k.', alpha=0.1,markersize=1, label='match with WISE')
#ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise4[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise4[uvmtchi[clpec]], 'bx', alpha=1,markersize=6,label='Confirmed GCs')
ax2.plot(pg[clpec][reccan]-pr[clpec][reccan], pr[clpec][reccan]-wise4[uvmtchi[clpec]][reccan], 'bx', alpha=1,markersize=8) #stacan
ax2.plot(pg[clpec][stacan]-pr[clpec][stacan], pr[clpec][stacan]-wise4[uvmtchi[clpec]][stacan], 'rx', alpha=1,markersize=8) 
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets ')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-w4)$')
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

#proj = np.sqrt((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-10.6847083)**2+(sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-41.26875)**2)*41/3
#fargc = np.where((proj>150)&(isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]<18))
ax2=plt.subplot(236)
ax2.plot(pra[clsuv], pdec[clsuv], 'k.', alpha=0.1,markersize=1)
#ax2.plot(pra[clsuv][gcwi], pdec[clsuv][gcwi], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'r.', alpha=1,markersize=7,label='GC candidates')
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], 'g.', alpha=1,markersize=9,label='GC candidates (>150 Kpc)')
#Confirmed GCs
ax2.plot(pra[clpec], pdec[clpec], 'bx', alpha=1,markersize=7,label='Confirmed GCs')
ax2.plot(pra[clpec][reccan], pdec[clpec][reccan], 'bx', alpha=1,markersize=8)
ax2.plot(pra[clpec][stacan], pdec[clpec][stacan], 'rx', alpha=1,markersize=8)
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(-2,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(pra[clsuv])),ra2kpc(min(pra[clsuv])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()


L = pra[clsuv][gcwi]
R = pdec[clsuv][gcwi]
print('all object in the box')
print(len(L))
for nr,nl in zip(L,R):
  print(nr,nl)


plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(pg[clsuv]-pr[clsuv], pi[clsuv], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(pg[clpec]-pr[clpec], pi[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(pg[clsuv]-pr[clsuv], pg[clsuv]-pz[clsuv], 'k.', alpha=0.1,markersize=0.5)
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-pz[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-z)$')
#ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
#ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((pra[clsuv][gcwi]-10.6847083)**2+(pdec[clsuv][gcwi]-41.26875)**2)*41/3
projcon = np.sqrt((pra[clpec]-10.6847083)**2+(pdec[clpec]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,pi[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, pi[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)
fargc = np.where((proj>130)&(proj>140))
L =  pra[clsuv][gcwi][fargc]
R =  pdec[clsuv][gcwi][fargc]
for lval,rval in zip(L,R):
     print(lval,rval)

"""#Pan-Star WISE up up

Candidate #3 #9
"""

import pandas as pd 
fs = fits.open('/gdrive/My Drive/Astro Research/M31/Pan-star/M31Panstallclusterff2_JiamingP.fit')
pstar = fs[1].data
pstarcd = SkyCoord(ra=pstar['raMean'][:],
                      dec=pstar['decMean'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
pstarcd = pstarcd.ravel()
pg = pstar['gMeanPSFMag'].ravel()
pi = pstar['iMeanPSFMag'].ravel()
pr = pstar['rMeanPSFMag'].ravel()
pz = pstar['zMeanPSFMag'].ravel()

pra = pstar['raMean'].ravel()
pdec = pstar['decMean'].ravel()

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/irac/irac_M31clusterall.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']


uvmtchi, uvmtchdist, _ = match_coordinates_sky(pstarcd,wisecd)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,wisecd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(pstarcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
print('identified GCs',len(galpec[clpec]))

#Extinction correction
scoordpd = SkyCoord(ra=pra, dec=pdec,
                         unit=(u.deg, u.deg), frame='icrs')

# SFD correction of magnitudes
sfd  = SFD(path=googlepath+"SFD/")
sgal_coords = scoordpd.galactic
x,y = sfd.wcs_south.wcs_world2pix(sgal_coords.l.deg, sgal_coords.b.deg, 0) #south
ok_coords, = np.where(x > 0)
EBV = np.zeros(len(scoordpd))
EBV[ok_coords] = sfd.sfd_north[x[ok_coords].astype(int),
                               y[ok_coords].astype(int)]

A_g = 3.172*EBV
A_r = 2.271*EBV
A_i = 1.682*EBV
A_z = 1.322*EBV

pg = np.hstack(pg)-A_g
pr = np.hstack(pr)-A_r
pi = np.hstack(pi)-A_i
pz = np.hstack(pz)-A_z

#xyp = np.empty([len(gsd),2]) 
#xyp[:,0] = usd-rsd
#xyp[:,1] = rsd-zsd

#pgcsd = Path([(1.7,0.45),(2.57,0.75),
#          (2.67,0.65),(2.2,0.42),
#          (1.8,0.3),(1.7,0.45)])
#ingcsd = pgcsd.contains_points(xyp) 
#gcsd = (ingcsd==True)
#gcsd = ((gsd<20)&(usd-rsd>1.7)&(usd-rsd<2.4))
#gcsd = ((ingcsd==True)&(gsd<20)&(radg<7)&(radg>2.5)&(usd<21)&(radu>2.5)&(radu<7)
#&(radz>2.5)&(radz<7)&(usd-rsd<2.5)&(gsd-rsd<1)&(gsd-rsd>-0.2)) # &(gsd-rsd<1)&(gsd-rsd>0.2)
#print('gcsd',gcsd)

xyj = np.empty([len(wise2[uvmtchi[clsuv]]),2]) 
xyj[:,1] = pr[clsuv]-wise2[uvmtchi[clsuv]]
xyj[:,0] =pg[clsuv]-pr[clsuv]

pgcwi = Path([(0.42,2.7),(0.6,2.96),
                        (0.7,3.4),(0.4,3.4),(0.42,2.7)])
ingcwi = pgcwi.contains_points(xyj) 
#gcwi = (ingcwi==True)
gcwi = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>3)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<5) #2.8 # for # 3 2-3 #2 3 -4
&(pg[clsuv]-pr[clsuv]>-0.2)&(pg[clsuv]-pr[clsuv]<0.5)) #0 -0.1

#gcwi = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>3.4)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<4.4)
#&(pg[clsuv]-pr[clsuv]>0.6)&(pg[clsuv]-pr[clsuv]<0.7))

#GC candidaets #2 7.2018
m31can5 = ((pra[clsuv][gcwi]>7.2017)&(pra[clsuv][gcwi]<7.2019))
#GC candidate #3 7.635
#m31can5 = ((pra[clsuv][gcwi]>7.634)&(pra[clsuv][gcwi]<7.636)) 
#10 8.151691
m31can10 = ((pra[clsuv][gcwi]>8.1515)&(pra[clsuv][gcwi]<8.1517)) 
#9 8.2046684 10.11932331
m31can9 = ((pra[clsuv][gcwi]>8.2045)&(pra[clsuv][gcwi]<8.2047)|
           (pra[clsuv][gcwi]>10.1192)&(pra[clsuv][gcwi]<10.1194)|
           (pra[clsuv][gcwi]>10.07824)&(pra[clsuv][gcwi]<10.07826)|
           (pra[clsuv][gcwi]>8.52060)&(pra[clsuv][gcwi]<8.52062)|
           (pra[clsuv][gcwi]>10.3641)&(pra[clsuv][gcwi]<10.3643)|
           (pra[clsuv][gcwi]>5.66040)&(pra[clsuv][gcwi]<5.66042)|
           (pra[clsuv][gcwi]>8.51981)&(pra[clsuv][gcwi]<8.51983)) 
#gccand = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>2.5)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<3.5))
plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise2[uvmtchi[clsuv]], 'k.', alpha=0.5,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise2[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise2[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise2[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #2')
#ax2.plot(pg[clsuv][gcwi][m31can10]-pr[clsuv][gcwi][m31can10], pr[clsuv][gcwi][m31can10]-wise2[uvmtchi[clsuv]][gcwi][m31can10], 'bv', alpha=1,markersize=10,label='GC Candidaets #10')
#ax2.plot(pg[clsuv][gcwi][m31can9]-pr[clsuv][gcwi][m31can9], pr[clsuv][gcwi][m31can9]-wise2[uvmtchi[clsuv]][gcwi][m31can9], 'gv', alpha=1,markersize=10,label='Other GC Candidaets')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-[4.6])$',fontsize = 15)
ax2.set_xlim(-1.5,1)
ax2.set_ylim(-2,5)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(pz[clsuv]-pr[clsuv], pg[clsuv]-pr[clsuv], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pz[clsuv][gcwi]-pr[clsuv][gcwi], pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pz[clpec]-pr[clpec], pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(pz[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #2')
ax2.plot(pz[clsuv][gcwi][m31can10]-pr[clsuv][gcwi][m31can10], pg[clsuv][gcwi][m31can10]-pr[clsuv][gcwi][m31can10], 'bv', alpha=1,markersize=10,label='GC Candidaets #10')
ax2.plot(pz[clsuv][gcwi][m31can9]-pr[clsuv][gcwi][m31can9], pg[clsuv][gcwi][m31can9]-pr[clsuv][gcwi][m31can9], 'gv', alpha=1,markersize=10)
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(z-r)$',fontsize = 15)
ax2.set_ylabel('$(g-r)$',fontsize = 15)
#ax2.set_xlim(0,7)
ax2.set_xlim(-0.7,1.25)
#ax2.set_ylim(0,16)
ax2.legend(loc='upper right', frameon=False)

ax2=plt.subplot(232)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise1[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise1[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise1[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #2')
ax2.plot(pg[clsuv][gcwi][m31can10]-pr[clsuv][gcwi][m31can10], pr[clsuv][gcwi][m31can10]-wise1[uvmtchi[clsuv]][gcwi][m31can10], 'bv', alpha=1,markersize=10,label='GC Candidaets #10')
ax2.plot(pg[clsuv][gcwi][m31can9]-pr[clsuv][gcwi][m31can9], pr[clsuv][gcwi][m31can9]-wise1[uvmtchi[clsuv]][gcwi][m31can9], 'gv', alpha=1,markersize=10)
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-[3.4])$',fontsize = 15)
ax2.set_xlim(-1.5,0.5)
#ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise3[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise3[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise3[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #3')
ax2.plot(pg[clsuv][gcwi][m31can10]-pr[clsuv][gcwi][m31can10], pr[clsuv][gcwi][m31can10]-wise3[uvmtchi[clsuv]][gcwi][m31can10], 'bv', alpha=1,markersize=10,label='GC Candidaets #10')
ax2.plot(pg[clsuv][gcwi][m31can9]-pr[clsuv][gcwi][m31can9], pr[clsuv][gcwi][m31can9]-wise3[uvmtchi[clsuv]][gcwi][m31can9], 'gv', alpha=1,markersize=10)
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-w3)$',fontsize = 15)
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise4[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise4[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise4[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #2')
ax2.plot(pg[clsuv][gcwi][m31can10]-pr[clsuv][gcwi][m31can10], pr[clsuv][gcwi][m31can10]-wise4[uvmtchi[clsuv]][gcwi][m31can10], 'bv', alpha=1,markersize=10,label='GC Candidaets #10')
ax2.plot(pg[clsuv][gcwi][m31can9]-pr[clsuv][gcwi][m31can9], pr[clsuv][gcwi][m31can9]-wise4[uvmtchi[clsuv]][gcwi][m31can9], 'gv', alpha=1,markersize=10)
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets ')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-w4)$',fontsize = 15)
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

#proj = np.sqrt((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-10.6847083)**2+(sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-41.26875)**2)*41/3
#fargc = np.where((proj>150)&(isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]<18))
ax2=plt.subplot(236)
ax2.plot(pra[clsuv], pdec[clsuv], 'k.', alpha=0.1,markersize=1)
ax2.plot(pra[clsuv][gcwi], pdec[clsuv][gcwi], 'r.', alpha=0.5,markersize=4,label='GC candidates')
ax2.plot(pra[clsuv][gcwi][m31can5], pdec[clsuv][gcwi][m31can5], 'rv', alpha=0.5,markersize=10,label='GC candidates #2')
ax2.plot(pra[clsuv][gcwi][m31can10], pdec[clsuv][gcwi][m31can10], 'bv', alpha=0.5,markersize=10,label='GC candidates #10')
ax2.plot(pra[clsuv][gcwi][m31can9], pdec[clsuv][gcwi][m31can9], 'gv', alpha=0.5,markersize=10)
#ax2.set_xlim(-2,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.set_xlabel('$RA$',fontsize = 15)
ax2.set_ylabel('$DEC$',fontsize = 15)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(pra[clsuv])),ra2kpc(min(pra[clsuv])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(pg[clsuv]-pr[clsuv], pi[clsuv], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(pg[clpec]-pr[clpec], pi[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(pg[clsuv]-pr[clsuv], pg[clsuv]-pz[clsuv], 'k.', alpha=0.1,markersize=0.5)
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-pz[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-z)$')
#ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
#ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((pra[clsuv][gcwi]-10.6847083)**2+(pdec[clsuv][gcwi]-41.26875)**2)*41/3
projcon = np.sqrt((pra[clpec]-10.6847083)**2+(pdec[clpec]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,pi[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, pi[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)
fargc = np.where((proj>150))
L =  pra[clsuv][gcwi][fargc]
R =  pdec[clsuv][gcwi][fargc]
for lval,rval in zip(L,R):
     print(lval,rval)

"""#Pan-star WISE left"""

import pandas as pd 
fs = fits.open('/gdrive/My Drive/Astro Research/M31/Pan-star/M31Panstallclusterf_JiamingP.fit')
pstar = fs[1].data
pstarcd = SkyCoord(ra=pstar['raMean'][:],
                      dec=pstar['decMean'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
pstarcd = pstarcd.ravel()
pg = pstar['gMeanPSFMag'].ravel()
pi = pstar['iMeanPSFMag'].ravel()
pr = pstar['rMeanPSFMag'].ravel()
pz = pstar['zMeanPSFMag'].ravel()

pra = pstar['raMean'].ravel()
pdec = pstar['decMean'].ravel()

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/irac/irac_M31clusterall.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']


uvmtchi, uvmtchdist, _ = match_coordinates_sky(pstarcd,wisecd)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,wisecd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(pstarcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
print('identified GCs',len(galpec[clpec]))

xyj = np.empty([len(wise2[uvmtchi[clsuv]]),2]) 
xyj[:,1] = pr[clsuv]-wise2[uvmtchi[clsuv]]
xyj[:,0] =pg[clsuv]-pr[clsuv]

pgcwi = Path([(0.42,2.7),(0.6,2.96),
                        (0.7,3.4),(0.4,3.4),(0.42,2.7)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = ((ingcwi==True)&(pr[clsuv]-wise1[uvmtchi[clsuv]]>2.4)&(pr[clsuv]-wise1[uvmtchi[clsuv]]<3.1)&(pr[clsuv]-wise4[uvmtchi[clsuv]]<10))
#gcwi = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>3.4)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<4.4)
#&(pg[clsuv]-pr[clsuv]>0.6)&(pg[clsuv]-pr[clsuv]<0.7))
#gcwi = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>4.4)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<5.4)
#&(pg[clsuv]-pr[clsuv]>0.4)&(pg[clsuv]-pr[clsuv]<0.6))
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]])

#gccand = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>2.5)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<3.5))
plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise2[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise2[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise2[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-[4.6])$',fontsize = 15)
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(pz[clsuv]-pr[clsuv], pg[clsuv]-pr[clsuv], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pz[clsuv][gcwi]-pr[clsuv][gcwi], pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pz[clpec]-pr[clpec], pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(z-r)$',fontsize = 15)
ax2.set_ylabel('$(g-r)$',fontsize = 15)
ax2.set_xlim(0,7)
#ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise1[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise1[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise1[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-[3.4])$',fontsize = 15)
ax2.set_xlim(-0.5,2.5)
#ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise3[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise3[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise3[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-w3)$',fontsize = 15)
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise4[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise4[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise4[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets ')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-w4)$',fontsize = 15)
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

#proj = np.sqrt((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-10.6847083)**2+(sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-41.26875)**2)*41/3
#fargc = np.where((proj>150)&(isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]<18))
ax2=plt.subplot(236)
ax2.plot(pra[clsuv], pdec[clsuv], 'k.', alpha=0.1,markersize=1)
ax2.plot(pra[clsuv][gcwi], pdec[clsuv][gcwi], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'r.', alpha=1,markersize=7,label='GC candidates')
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], 'g.', alpha=1,markersize=9,label='GC candidates (>150 Kpc)')
#Confirmed GCs
ax2.plot(pra[clpec], pdec[clpec], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(-2,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.set_xlabel('$RA$',fontsize = 15)
ax2.set_ylabel('$DEC$',fontsize = 15)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(pra[clsuv])),ra2kpc(min(pra[clsuv])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(pg[clsuv]-pr[clsuv], pi[clsuv], 'k.', alpha=0.01,markersize=0.5)
#ax2.plot(pg[clpec]-pr[clpec], pi[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(pg[clsuv]-pr[clsuv], pg[clsuv]-pz[clsuv], 'k.', alpha=0.1,markersize=0.5)
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-pz[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-z)$')
#ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((pra[clsuv][gcwi]-10.6847083)**2+(pdec[clsuv][gcwi]-41.26875)**2)*41/3
projcon = np.sqrt((pra[clpec]-10.6847083)**2+(pdec[clpec]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,pi[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, pi[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)
fargc = np.where((proj>150))
L =  pra[clsuv][gcwi][fargc]
R =  pdec[clsuv][gcwi][fargc]
for lval,rval in zip(L,R):
     print(lval,rval)

"""#Pan-star GALEX M31"""

import pandas as pd 
fs = fits.open('/gdrive/My Drive/Astro Research/M31/Pan-star/M31Panstallcluster3_JiamingP.fit')
pstar = fs[1].data
pstarcd = SkyCoord(ra=pstar['raMean'][:],
                      dec=pstar['decMean'][:],
                      unit=(u.deg, u.deg), frame='icrs')
pstarcd = pstarcd.ravel()
fs.close()
pg = pstar['gMeanPSFMag'].ravel()
pi = pstar['iMeanPSFMag'].ravel()
pr = pstar['rMeanPSFMag'].ravel()
pz = pstar['zMeanPSFMag'].ravel()

pra = pstar['raMean'].ravel()
pdec = pstar['decMean'].ravel()

fnew = fits.open('/gdrive/My Drive/Astro Research/M31/GALEX/M31GALEXLallcluster2_jiamingp.fit')
galex = fnew[1].data
galexcd = SkyCoord(ra=galex['ra'][:],
                      dec=galex['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fnew.close()
galexcd = galexcd.ravel()


uvmtchi, uvmtchdist, _ = match_coordinates_sky(pstarcd,galexcd)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,galexcd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(pstarcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
print('identified GCs',len(galpec[clpec]))

"""#Pan-star Gaia DR3 (25,45)"""

import pandas as pd 
fs = fits.open('/gdrive/My Drive/Astro Research/M31/Pan-star/M31Panstallclusterlf_JiamingP.fit')
pstar = fs[1].data
pstarcd = SkyCoord(ra=pstar['raMean'][:],
                      dec=pstar['decMean'][:],
                      unit=(u.deg, u.deg), frame='icrs')
pstarcd = pstarcd.ravel()
fs.close()
pg = pstar['gMeanPSFMag'].ravel()
pi = pstar['iMeanPSFMag'].ravel()
pr = pstar['rMeanPSFMag'].ravel()
pz = pstar['zMeanPSFMag'].ravel()

pra = pstar['raMean'].ravel()
pdec = pstar['decMean'].ravel()


fgag = fits.open('/gdrive/My Drive/Astro Research/M31/Gaia DR3/M31L2545.fits.gz')
gaia3 = fgag[1].data
gaiaccd = SkyCoord(ra=gaia3['ra'][:],
                      dec=gaia3['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fgag.close()

ggga = gaia3['phot_g_mean_mag']
bpgga = gaia3['phot_bp_mean_mag'] 
rpgga = gaia3['phot_rp_mean_mag'] 
bregga = gaia3['phot_bp_rp_excess_factor']
aengga = gaia3['astrometric_excess_noise']
ra31 = gaia3['dr2_radial_velocity']
pa31 = gaia3['parallax']

ggra=gaia3['ra']
ggdec=gaia3['dec']

wisemtchi, wisemtchdist, _ = match_coordinates_sky(pstarcd,gaiaccd)
cls = wisemtchdist.arcsec<0.75
#    irgc, irgcdist, _ = match_coordinates_sky(iraccd,knowngc)
fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 
#gawispece, gawispecdiste, _ = match_coordinates_sky(wisecd,speccald) 
#gcwi = gawispecdiste.arcsec<0.53

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,gaiaccd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<2

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and GAIA 
wispec, wispecdist, _ = match_coordinates_sky(pstarcd,speccald[gawiclpec]) 
# find nearest match
clpec = wispecdist.arcsec<2

print('#GCs in Pan-star Gaia',len(pg[clpec]))

gapcand = np.where((pr[cls]-pz[cls]>1)&(pr[cls]-pz[cls]<2)&(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]]>1)&(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]]<1.5)&(ggga[wisemtchi[cls]]>20.7))


plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
#figure(1).clear()
ax2=plt.subplot(231)
#GAIA Data black
#x2.plot(bpgga-rpgga, ggga, 'k.', alpha=0.02,markersize=2,lw=0, markeredgecolor='none')

ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]], 'k.', alpha=0.4,markersize=1, label='match with Pan-star')
ax2.plot(bpgga[wisemtchi[cls]][gapcand]-rpgga[wisemtchi[cls]][gapcand], ggga[wisemtchi[cls]][gapcand],'r.', alpha=0.6,markersize=5,label='GC candidates')
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G$')
ax2.set_xlim(-1,3.5)
ax2.set_ylim(22,16)
ax2.legend(loc='upper left', frameon=False)


ax2=plt.subplot(232)
ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-pz[cls], 'k.', alpha=0.3,markersize=1)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise1[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.8,markersize=2,label='GC candidates (gaia)')
#ax2.plot(bpga[gairmtchi[cls&bigblu[irmtchi]]]-rpga[gairmtchi[cls&bigblu[irmtchi]]], gga[gairmtchi[cls&bigblu[irmtchi]]]-iracmag[cls&bigblu[irmtchi]],'b.', alpha=0.7,markersize=2,label='IRAC candidates')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-pz[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(bp-rp)$')
ax2.set_ylabel('$G-z$')
#ax2.set_xlim(-0.5,4)
ax2.set_ylim(-1,9)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(233)
ax2.plot(pg[cls]-pr[cls], pr[cls]-pz[cls], 'k.', alpha=0.2,markersize=2)#gapcand
ax2.plot(pg[cls][gapcand]-pr[cls][gapcand], pr[cls][gapcand]-pz[cls][gapcand],'r.', alpha=0.6,markersize=2,label='GC candidates')
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise2[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.6,markersize=2,label='GC candidates (gaia)')
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga]-wise2[cls&gcgalaxy[wisemtchi]][gcwiga],'r.', alpha=0.8,markersize=2,label='GC candidates')
#Galaxy
#ax2.plot(bpga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-rpga[gairmtchi[cls&bigblugalaxy[irmtchi]]], gga[gairmtchi[cls&bigblugalaxy[irmtchi]]]-iracmag[cls&bigblugalaxy[irmtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#ax2.plot(bpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-rpga[wisemtchi[cls&bigblugalaxy[wisemtchi]]], gga[wisemtchi[cls&bigblugalaxy[wisemtchi]]]-wise1[cls&bigblugalaxy[wisemtchi]],'y.', alpha=1,markersize=2,label='IRAC galaxy')
#Color coded different GCs from different papers
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-pz[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs') 
#Nantais
#ax2.plot(gnew[irmtchi[clsgcc]][nan]-rnew[irmtchi[clsgcc]][nan], inew[irmtchi[clsgcc]][nan]-iracmag[clsgcc][nan], 'rx', alpha=1,markersize=4)
#PBH
#ax2.plot(gnew[irmtchi[clsgcc]][pbh]-rnew[irmtchi[clsgcc]][pbh], inew[irmtchi[clsgcc]][pbh]-iracmag[clsgcc][pbh], 'yx', alpha=1,markersize=4)
#Ghost
#ax2.plot(gnew[irmtchi[clsgcc]][gho]-rnew[irmtchi[clsgcc]][gho], inew[irmtchi[clsgcc]][gho]-iracmag[clsgcc][gho], 'cx', alpha=1,markersize=4)
#ax2.plot(gnew[irmtchi[cls&starsmall[irmtchi]]]-rnew[irmtchi[cls&starsmall[irmtchi]]], inew[irmtchi[cls&starsmall[irmtchi]]]-iracmag[cls&starsmall[irmtchi]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#    ax2.plot([-1,1],[-3.05,-0.35],'b-')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$r-z$')
ax2.set_ylim(-1,4)
#ax2.set_xlim(-0.5,4)
#ax2.set_ylim(0,9)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(pg[cls]-pr[cls], pr[cls]-ggga[wisemtchi[cls]], 'k.', alpha=0.2,markersize=2)
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-pz[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$r-G$')
ax2.legend(loc='upper left', frameon=False)

#ax2=plt.subplot(234)
#ax2.plot(bpgga[wisemtchi[cls]]-rpgga[wisemtchi[cls]], ggga[wisemtchi[cls]]-wise3[cls], 'k.', alpha=0.08,markersize=2)
#ax2.plot(bpga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-rpga[wisemtchi[cls&gcgalaxy[wisemtchi]]], gga[wisemtchi[cls&gcgalaxy[wisemtchi]]]-wise3[cls&gcgalaxy[wisemtchi]],'g.', alpha=0.8,markersize=2,label='GC candidates (gaia)')
#ax2.plot(bpgga[wisemtchi[clpec]]-rpgga[wisemtchi[clpec]], ggga[wisemtchi[clpec]]-wise3[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.set_xlabel('$(bp-rp)$')
#ax2.set_ylabel('$G-[12]$')
#ax2.set_xlim(-0.5,4)
#ax2.set_ylim(0,12)
#ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(ggra[wisemtchi[cls]], ggdec[wisemtchi[cls]], 'k.', alpha=0.1,markersize=2)
ax2.plot(ggra[wisemtchi[cls]][gapcand], ggdec[wisemtchi[cls]][gapcand], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(gra[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], gdec[wisemtchi[cls&gcgalaxy[wisemtchi]]][gcwiga], 'r.', alpha=0.5,markersize=4,label='GC candidates')
#Confirmed GCs
ax2.plot(ggra[wisemtchi[clpec]], ggdec[wisemtchi[clpec]], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
#ax2.set_xlim(9.18470833,12.18470833) 
#ax2.set_ylim(42.26875,40.26875)
ax2.legend(loc='upper left', frameon=False)
ax2.invert_xaxis()
#plt.tight_layout()

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(ggra[wisemtchi[cls]])),ra2kpc(min(ggra[wisemtchi[cls]])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
print(len(ggra[wispec[clpec]]))

plt.tight_layout()

proj = np.sqrt((ggra[wisemtchi[cls]][gapcand]-10.6847083)**2+(ggdec[wisemtchi[cls]][gapcand]-41.26875)**2)*41/3
fargc = np.where((proj>150))
L =  ggra[wisemtchi[cls]][gapcand][fargc]
R =  ggdec[wisemtchi[cls]][gapcand][fargc]
for lval,rval in zip(L,R):
     print(lval,rval)

"""#Pan-star WISE (0, 49)
Candidate
"""

import pandas as pd 
fs = fits.open('/gdrive/My Drive/Astro Research/M31/Pan-star/M31Panstallclusterup_JiamingP.fit')
pstar = fs[1].data
pstarcd = SkyCoord(ra=pstar['raMean'][:],
                      dec=pstar['decMean'][:],
                      unit=(u.deg, u.deg), frame='icrs')
fs.close()
pstarcd = pstarcd.ravel()
pg = pstar['gMeanPSFMag'].ravel()
pi = pstar['iMeanPSFMag'].ravel()
pr = pstar['rMeanPSFMag'].ravel()
pz = pstar['zMeanPSFMag'].ravel()

pra = pstar['raMean'].ravel()
pdec = pstar['decMean'].ravel()

wise = pd.read_csv('/gdrive/My Drive/Astro Research/M31/irac/irac_M31clusterall.csv', sep=',')
wisecd = SkyCoord(ra=wise['ra'][:],
                      dec=wise['dec'][:],
                      unit=(u.deg, u.deg), frame='icrs')

wise1 = wise['w1mpro']
#4.6um
wise2 = wise['w2mpro']
#12um
wise3 = wise['w3mpro']
#22um
wise4 = wise['w4mpro']


uvmtchi, uvmtchdist, _ = match_coordinates_sky(pstarcd,wisecd)
clsuv = uvmtchdist.arcsec<0.75

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
caldwell = fm31[1].data
fm31.close()

# read in the data. These include all know data
speccald = SkyCoord(ra=np.hstack([caldwell['RAJ2000']]),
                    dec=np.hstack([caldwell['DEJ2000']]),
                    unit=(u.deg, u.deg), frame='icrs') 

gawispec, gawispecdist, _ = match_coordinates_sky(speccald,wisecd) 
# find nearest match
gawiclpec =  gawispecdist.arcsec<0.8

# format the coordinates as a special coordinate data type, add on the to ghosts globular clusters to the list
#confirmed GCs at both WISE and SDSS confirmed GCs
galpec, galpecdist, _ = match_coordinates_sky(pstarcd,speccald[gawiclpec]) 
# find nearest match
clpec = galpecdist.arcsec<0.8
print('identified GCs',len(galpec[clpec]))

#Extinction correction
scoordpd = SkyCoord(ra=pra, dec=pdec,
                         unit=(u.deg, u.deg), frame='icrs')

# SFD correction of magnitudes
sfd  = SFD(path=googlepath+"SFD/")
sgal_coords = scoordpd.galactic
x,y = sfd.wcs_south.wcs_world2pix(sgal_coords.l.deg, sgal_coords.b.deg, 0) #south
ok_coords, = np.where(x > 0)
EBV = np.zeros(len(scoordpd))
EBV[ok_coords] = sfd.sfd_north[x[ok_coords].astype(int),
                               y[ok_coords].astype(int)]

A_g = 3.172*EBV
A_r = 2.271*EBV
A_i = 1.682*EBV
A_z = 1.322*EBV

pg = np.hstack(pg)-A_g
pr = np.hstack(pr)-A_r
pi = np.hstack(pi)-A_i
pz = np.hstack(pz)-A_z

xyj = np.empty([len(wise2[uvmtchi[clsuv]]),2]) 
xyj[:,1] = pr[clsuv]-wise2[uvmtchi[clsuv]]
xyj[:,0] =pg[clsuv]-pr[clsuv]

pgcwi = Path([(0.42-0.5,1.8),(0.65-0.2,1.8),
                        (0.7-0.2,2.6),(0.4-0.5,2.6),(0.42-0.5,1.8)])
ingcwi = pgcwi.contains_points(xyj) 
gcwi = ((ingcwi==True)&(pr[clsuv]-wise4[uvmtchi[clsuv]]>10)&(pr[clsuv]-wise4[uvmtchi[clsuv]]<11)&
        (pz[clsuv]-pr[clsuv]>-0.5)
        &(pz[clsuv]-pr[clsuv]<-0.2))# &(pz[clsuv]-pr[clsuv]<-0.5) 10-11
#print(gsd[wisemtchi[cls&gcsd[wisemtchi]]]) &(pz[clsuv]-pr[clsuv]<-0.45)

#gccand = ((pr[clsuv]-wise2[uvmtchi[clsuv]]>2.5)&(pr[clsuv]-wise2[uvmtchi[clsuv]]<3.5))

#GC candidaets #5
#m31can5 = ((pra[clsuv][gcwi]>0.4522)&(pra[clsuv][gcwi]<0.4622))
#GC candidate #6 2.277
#m31can5 = ((pra[clsuv][gcwi]>2.276)&(pra[clsuv][gcwi]<2.278))
#GC candidate #7 0.025
m31can5 = ((pra[clsuv][gcwi]>0.024)&(pra[clsuv][gcwi]<0.0256))

plt.figure(figsize=(18*1.8,9*1.8),frameon=False)
ax2=plt.subplot(231)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise2[uvmtchi[clsuv]], 'k.', alpha=0.5,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise2[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise2[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise2[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #7')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-[4.6])$',fontsize = 15)
ax2.set_xlim(-0.5,2.5)
ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)
#ax2.add_patch(PathPatch(pgcwi,facecolor='none',edgecolor='red',lw=1.5))
#print(wise2[cls&gcsd[wisemtchi]])


ax2=plt.subplot(233)
ax2.plot(pz[clsuv]-pr[clsuv], pg[clsuv]-pr[clsuv], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pz[clsuv][gcwi]-pr[clsuv][gcwi], pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pz[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #7')
#ax2.plot(pz[clpec]-pr[clpec], pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise4[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(z-r)$',fontsize = 15)
ax2.set_ylabel('$(g-r)$',fontsize = 15)
ax2.set_xlim(-2,1)
#ax2.set_ylim(0,16)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(232)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise1[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise1[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise1[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #7')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise1[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-isd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-[3.4])$',fontsize = 15)
#ax2.set_xlim(-0.5,2.5)
#ax2.set_ylim(0,8)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(234)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise3[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise3[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise3[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #7')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise2[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise2[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-w3)$',fontsize = 15)
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,6)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(235)
ax2.plot(pg[clsuv]-pr[clsuv], pr[clsuv]-wise4[uvmtchi[clsuv]], 'k.', alpha=0.05,markersize=1, label='match with WISE')
ax2.plot(pg[clsuv][gcwi]-pr[clsuv][gcwi], pr[clsuv][gcwi]-wise4[uvmtchi[clsuv]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.plot(pg[clsuv][gcwi][m31can5]-pr[clsuv][gcwi][m31can5], pr[clsuv][gcwi][m31can5]-wise4[uvmtchi[clsuv]][gcwi][m31can5], 'rv', alpha=1,markersize=10,label='GC Candidaets #7')
#ax2.plot(pg[wisemtchi[cls]]-pr[wisemtchi[cls]], rsd[wisemtchi[cls]]-wise2[cls], 'k.', alpha=0.05,markersize=1, label='match with WISE')
#ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-wise4[uvmtchi[clpec]], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], zsd[wisemtchi[cls&gcsd[wisemtchi]]]-wise1[cls&gcsd[wisemtchi]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-wise1[cls&gcsd[wisemtchi]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets ')
ax2.set_xlabel('$(g-r)$',fontsize = 15)
ax2.set_ylabel('$(r-w4)$',fontsize = 15)
#ax2.set_xlim(1,7)
#ax2.set_ylim(0,5)
ax2.legend(loc='upper left', frameon=False)

#proj = np.sqrt((sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-10.6847083)**2+(sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-41.26875)**2)*41/3
#fargc = np.where((proj>150)&(isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]<18))
ax2=plt.subplot(236)
ax2.plot(pra[clsuv], pdec[clsuv], 'k.', alpha=0.1,markersize=1)
ax2.plot(pra[clsuv][gcwi], pdec[clsuv][gcwi], 'r.', alpha=0.5,markersize=6,label='GC candidates')
ax2.plot(pra[clsuv][gcwi][m31can5], pdec[clsuv][gcwi][m31can5], 'rv', alpha=0.5,markersize=10,label='GC candidates #7')
ax2.set_xlabel('$RA$',fontsize = 15)
ax2.set_ylabel('$DEC$',fontsize = 15)
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'r.', alpha=1,markersize=7,label='GC candidates')
#ax2.plot(sra[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], sdec[wisemtchi[cls&gcsd[wisemtchi]]][gcwi][fargc], 'g.', alpha=1,markersize=9,label='GC candidates (>150 Kpc)')
#Confirmed GCs
#ax2.plot(pra[clpec], pdec[clpec], 'bx', alpha=1,markersize=5,label='Confirmed GCs')
#Good candidtaes in Subaru and can be found in Irac
#ax2.plot(ra[irmtchi[cls&posscand[irmtchi]]], dec[irmtchi[cls&posscand[irmtchi]]],'g.', alpha=0.25,markersize=2)
#ax2.plot(ra[irmtchi[cls&starsmall[irmtchi]]], dec[irmtchi[cls&starsmall[irmtchi]]], 'r.', alpha=0.1,markersize=2,lw=0, markeredgecolor='none')
ax2.set_xlim(3,-3) 
ax2.set_ylim(47,52)
ax2.invert_xaxis()
ax2.legend(loc='upper left', frameon=False)

ax22 = ax2.twiny()
ax22.set_xlim(ra2kpc(max(pra[clsuv])),ra2kpc(min(pra[clsuv])))
ax22.tick_params(axis='both',which='both',direction='in',labelsize=20)
ax22.set_xlabel(r'$R\ {\rm (kpc)}$',fontsize=22)
#print(len(ggra[wispec[clpec]]))

plt.tight_layout()

plt.figure(figsize=(12*1.5,12*1.5),frameon=False)

ax2=plt.subplot(221)
ax2.plot(pg[clsuv]-pr[clsuv], pi[clsuv], 'k.', alpha=0.01,markersize=0.5)
ax2.plot(pg[clpec]-pr[clpec], pi[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], isd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(gsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], isd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(i)$')
ax2.set_xlim(ccx[0]+1,ccx[-1])
ax2.set_ylim(23,10)
ax2.legend(loc='upper left', frameon=False)

ax2=plt.subplot(222)
ax2.plot(pg[clsuv]-pr[clsuv], pg[clsuv]-pz[clsuv], 'k.', alpha=0.1,markersize=0.5)
ax2.plot(pg[clpec]-pr[clpec], pr[clpec]-pz[clpec], 'bx', alpha=1,markersize=4,label='Confirmed GCs')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]]-rsd[wisemtchi[cls&gcsd[wisemtchi]]], rsd[wisemtchi[cls&gcsd[wisemtchi]]]-zsd[wisemtchi[cls&gcsd[wisemtchi]]], 'rx', alpha=0.2,markersize=4,label='GC Candidaets from SDSS')
#ax2.plot(usd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], rsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi]-zsd[wisemtchi[cls&gcsd[wisemtchi]]][gcwi], 'rx', alpha=1,markersize=5,label='GC Candidaets')
ax2.set_xlabel('$(g-r)$')
ax2.set_ylabel('$(r-z)$')
#ax2.set_xlim(ccx[0]+1,ccx[-1]+2)
#ax2.set_ylim(ccy[0],ccy[-1])
ax2.legend(loc='upper left', frameon=False)

proj = np.sqrt((pra[clsuv][gcwi]-10.6847083)**2+(pdec[clsuv][gcwi]-41.26875)**2)*41/3
projcon = np.sqrt((pra[clpec]-10.6847083)**2+(pdec[clpec]-41.26875)**2)*41/3
#projconta = np.sqrt((ggra[gaclpec][conta]-10.6847083)**2+(ggdec[gaclpec][conta]-41.26875)**2)*41/3
#projm31can = np.sqrt((ggra[gcga][m31can]-10.6847083)**2+(ggdec[gcga][m31can]-41.26875)**2)*41/3
plt.tight_layout()
#plt.figure(figsize=(15*1.2,11*1.2),frameon=False)

plt.figure(figsize=(18*1.5,9*1.5),frameon=False)
ax2=plt.subplot(231)
ax2.set_ylim(19,10)
ax2.set_xlim(0,230)
#plt.plot(proj, ggga, 'k.', alpha=0.01,markersize=1)
plt.plot(proj,pi[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon, pi[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
#ax2.plot(projm31can,ggga[gcga][m31can], 'g.', alpha=0.5,markersize=4,label='GC candidates')
#ax2.plot(bpggac-gggac, gggac-rpggac, 'gx', alpha=1,markersize=5,label='GC candidates')
#plt.plot(bpgga[gaclpec][smalex]-ggga[gaclpec][smalex], ggga[gaclpec][smalex]-rpgga[gaclpec][smalex], 'bx', alpha=1,markersize=4 ,label='confirmed GCs')
#plt.plot(bpga[clcc]-gga[clcc], gga[clcc]-rpga[clcc], 'rx', alpha=1,markersize=3 ,label='GCs subaru')
#plt.plot(bpgga[gacl]-ggga[gacl], ggga[gacl]-rpgga[gacl], 'g.', alpha=0.7,markersize=2,label='GC candidates')
#plt.plot(bpgga[gaclpec][innergc]-ggga[gaclpec][innergc], ggga[gaclpec][innergc]-rpgga[gaclpec][innergc], 'bx', alpha=1,markersize=4 )
#plt.plot(bpgga[gaclpec][outergc]-ggga[gaclpec][outergc], ggga[gaclpec][outergc]-rpgga[gaclpec][outergc], 'rx', alpha=1,markersize=4 ,label='outer GCs ')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$i$',fontsize=15)
#ax2.legend(loc='lower left', frameo

ax2=plt.subplot(232)
ax2.set_ylim(0,2)
ax2.set_xlim(0,230)
plt.plot(proj, pg[clsuv][gcwi]-pr[clsuv][gcwi], 'rx', alpha=1,markersize=4 ,label='GC Candidates')
plt.plot(projcon,pg[clpec]-pr[clpec], 'bx', alpha=1,markersize=6 ,label='confirmed GCs')
ax2.set_xlabel('$R_{proj}$ (Kpc)',fontsize=15)
ax2.set_ylabel('$g-r$',fontsize=15)
fargc = np.where((proj>150))
L =  pra[clsuv][gcwi][fargc]
R =  pdec[clsuv][gcwi][fargc]
for lval,rval in zip(L,R):
     print(lval,rval)

"""#M31 Pan-star Images"""

#fits.info('/gdrive/My Drive/Astro Research/M31/Pan-star image/M31halo.fits.fz')

image_data = fits.getdata('/gdrive/My Drive/Astro Research/M31/Pan-star image/M31halo.fits.fz', ext=0)
plt.figure()
#plt.imshow(image_data)


#plt.figure(figsize=(8,8),frameon=False)
#ax2=plt.subplot(111)
#plt.imshow(image_data, cmap='gray')
#ax2.set_xlabel('ra')
#ax2.set_ylabel('dec')
#ax2.set_xlim(9.9353,9.9357)
#ax2.set_ylim(30.4284,30.4288)

fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Mackey_2018_ Pandas.fit')
mackey = fm31[1].data
fm31.close()
print(mackey)


fm31 = fits.open('/gdrive/My Drive/Astro Research/M31 confirmed GCs/Nelson Caldwell 2016.fit')
caldwell = fm31[1].data
fm31.close()
#print(caldwell)